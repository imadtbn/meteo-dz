<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع الطقس الجزائري - تنبؤات حقيقية مباشرة</title>

    <!-- ضبط العرض للهواتف -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="msvalidate.01" content="9BCA38377A234DCCEB9991EAD1A2F6C2" />

    <!-- أيقونة الموقع -->
    <link rel="icon" href="images/icon1.webp" alt="icon" type="image/png" loading="lazy" class="welcome-logo">
    <link rel="icon" href="https://raw.githubusercontent.com/imadtbn/meteo-dz/refs/heads/main/images/icon1.webp"
        type="image/png">


    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <!-- Meta Description -->
    <meta name="description"
        content="تنبؤات الطقس في الجزائر لحظة بلحظة، خرائط تفاعلية، تحذيرات جوية، أخبار الطقس، توقعات 7 أيام، وواجهة سريعة وسهلة.">

    <meta name="google-site-verification" content="f5Xi4oFx0v5dN6iPZd9qCw-7vnc3vIbAeYF9jr4vwVM" />

    <!-- Keywords (اختياري) -->
    <meta name="keywords" content="
طقس الجزائر, أحوال الطقس في الجزائر, حالة الطقس اليوم, الطقس الأسبوعي, الطقس الآن,
توقعات الطقس الجزائر, نشرة جوية الجزائر, درجات الحرارة الجزائر, تنبؤات الطقس, رادار الطقس,
خرائط الطقس الجزائر, طقس الولايات, طقس الجزائر العاصمة, طقس وهران, طقس قسنطينة,
تنبيهات الطقس, أمطار الجزائر, رياح الجزائر, ثلوج الجزائر, موجة حر الجزائر, منخفض جوي الجزائر,
weather algeria, algeria forecast, algeria weather map, meteo algerie, meteo dz,
توقعات المطر, توقعات الرياح, توقعات الحرارة, موجة برد, منخفض جوي,
أخبار الطقس الجزائر, صور الطقس, مناخ الجزائر
">


    <!-- Author -->
    <meta name="author" content="الطقس الجزائري">


    <!-- SEO Essentials -->
    <meta name="description"
        content="توقعات الطقس في الجزائر لحظة بلحظة مع خرائط تفاعلية، تنبيهات جوية، درجات الحرارة، أحوال الطقس في جميع الولايات، وتحديثات دقيقة متجددة.">
    <meta name="keywords"
        content="طقس الجزائر, أحوال الطقس في الجزائر, حالة الطقس اليوم, الطقس الأسبوعي, الطقس الآن, توقعات الطقس الجزائر, نشرة جوية الجزائر, درجات الحرارة الجزائر, تنبؤات الطقس, رادار الطقس, خرائط الطقس الجزائر, طقس الولايات, طقس الجزائر العاصمة, طقس وهران, طقس قسنطينة, تنبيهات الطقس, أمطار الجزائر, رياح الجزائر, ثلوج الجزائر, موجة حر الجزائر, منخفض جوي الجزائر, weather algeria, algeria forecast, algeria weather map, meteo algerie, meteo dz, توقعات المطر, توقعات الرياح, توقعات الحرارة, منخفض جوي, أخبار الطقس الجزائر, مناخ الجزائر">
    <meta name="author" content="الطقس الجزائري">

    <!-- Canonical -->
    <link rel="canonical" href="https://imadtbn.github.io/meteo-dz/">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="الطقس الجزائري – توقعات لحظة بلحظة">
    <meta property="og:description" content="توقعات مفصلة لجميع ولايات الجزائر مع خرائط تفاعلية وتنبيهات جوية دقيقة.">
    <meta property="og:url" content="https://imadtbn.github.io/meteo-dz/">
    <meta property="og:type" content="website">
    <meta property="og:image"
        content="https://raw.githubusercontent.com/imadtbn/meteo-dz/refs/heads/main/images/icon1.webp">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="الطقس الجزائري – توقعات دقيقة">
    <meta name="twitter:description" content="تحديثات الأحوال الجوية في الجزائر مع خرائط وبيانات لحظية.">
    <meta name="twitter:image"
        content="https://raw.githubusercontent.com/imadtbn/meteo-dz/refs/heads/main/images/icon1.webp">

    <!-- Structured Data - JSON-LD -->
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WeatherForecast",
  "name": "الطقس الجزائري",
  "description": "توقعات الطقس في الجزائر مع تحديثات لحظية وخرائط تفاعلية.",
  "url": "https://imadtbn.github.io/meteo-dz/",
  "publisher": {
    "@type": "Organization",
    "name": "الطقس الجزائري",
    "url": "https://imadtbn.github.io/meteo-dz/"
  },
  "areaServed": "Algeria"
}
</script>

    <!-- Website Search Schema -->
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "https://imadtbn.github.io/meteo-dz/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://imadtbn.github.io/meteo-dz/?city={search_term}",
    "query-input": "required name=search_term"
  }
}
</script>

    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #3b82f6;
            --alert-red: #dc2626;
            --warning-orange: #f59e0b;
            --success-green: #10b981;
            --dark-bg: #0f172a;
            --light-bg: #f8fafc;
            --algeria-green: #006233;
            --algeria-red: #d21034;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--light-bg);
            color: #1e293b;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        .dark-mode {
            background-color: var(--dark-bg);
            color: #e2e8f0;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--algeria-green), var(--primary-blue));
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* إخفاء الهيدر عند التمرير */
        .hidden-header {
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        header {
            transition: transform 0.3s ease;
        }


        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo .algeria-flag {
            display: inline-block;
            width: 30px;
            height: 20px;
            background: linear-gradient(to right, var(--algeria-green) 50%, white 50%);
            position: relative;
            margin-right: 10px;
        }

        .logo .algeria-flag::before {
            content: '★';
            position: absolute;
            color: var(--algeria-red);
            font-size: 10px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: opacity 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }

        nav a:hover,
        nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-container {
            position: relative;
        }

        .search-container input {
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: none;
            border-radius: 25px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            width: 250px;
            font-family: 'Cairo', sans-serif;
        }

        .search-container input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Alert Banner */
        .alert-banner {
            background-color: var(--algeria-red);
            color: white;
            padding: 0.8rem 2rem;
            text-align: center;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Main Content */
        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .hero-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 992px) {
            .hero-section {
                grid-template-columns: 1fr;
            }
        }

        /* Current Weather Card */
        .current-weather {
            background: linear-gradient(135deg, var(--algeria-green), var(--primary-blue));
            color: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0, 98, 51, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 300px;
        }

        .current-weather::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .location h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .last-update {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .current-temp {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .temp-main {
            text-align: center;
        }

        .temp-main .temp {
            font-size: 5rem;
            font-weight: 700;
            line-height: 1;
        }

        .temp-main .condition {
            font-size: 1.5rem;
            margin-top: 0.5rem;
        }

        .weather-icon {
            font-size: 6rem;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .weather-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .detail-item {
            text-align: center;
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .detail-item i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* News Ticker */
        .news-ticker {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }

        .dark-mode .news-ticker {
            background-color: #1e293b;
        }

        .ticker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .dark-mode .ticker-header {
            border-bottom-color: #334155;
        }

        .ticker-header h3 {
            font-size: 1.3rem;
            color: var(--algeria-green);
        }

        .live-badge {
            background-color: var(--algeria-red);
            color: white;
            padding: 0.2rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ticker-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .news-item {
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .dark-mode .news-item {
            border-bottom-color: #334155;
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-item h4 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }

        .dark-mode .news-item h4 {
            color: #e2e8f0;
        }

        .news-item p {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .news-time {
            font-size: 0.8rem;
            color: var(--algeria-green);
        }

        /* Forecast Section */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: var(--algeria-green);
            position: relative;
            padding-right: 1rem;
        }

        .section-header h2::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: -5px;
            width: 50px;
            height: 3px;
            background-color: var(--algeria-green);
        }

        .btn {
            background-color: var(--algeria-green);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: var(--primary-blue);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 1200px) {
            .forecast-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .forecast-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .forecast-container {
                grid-template-columns: 1fr;
            }
        }

        .forecast-card {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .dark-mode .forecast-card {
            background-color: #1e293b;
        }

        .forecast-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .forecast-day {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--algeria-green);
        }

        .forecast-date {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 1rem;
        }

        .forecast-icon {
            font-size: 3rem;
            margin: 1rem 0;
        }

        .forecast-temp {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .high-temp {
            color: var(--algeria-red);
            font-weight: 700;
        }

        .low-temp {
            color: var(--primary-blue);
            font-weight: 700;
        }

        /* Weather Map */
        .weather-map-container {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
        }

        .dark-mode .weather-map-container {
            background-color: #1e293b;
        }

        .map-wrapper {
            height: 500px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 1rem;
            border: 1px solid #e2e8f0;
        }

        .map-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            z-index: 1000;
            direction: rtl;
        }

        .map-legend h4 {
            margin: 0 0 6px 0;
            font-size: 14px;
            font-weight: bold;
        }

        .map-legend .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .map-legend .color-box {
            width: 25px;
            height: 14px;
            display: inline-block;
            border: 1px solid #333;
        }


        .dark-mode .map-wrapper {
            border-color: #334155;
        }

        #weatherMap {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .map-btn {
            background-color: #e2e8f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .dark-mode .map-btn {
            background-color: #334155;
            color: #e2e8f0;
        }

        .map-btn.active {
            background-color: var(--algeria-green);
            color: white;
        }

        /* Gallery */
        .gallery-container {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
        }

        .dark-mode .gallery-container {
            background-color: #1e293b;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .gallery-item {
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            height: 200px;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: white;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        /* Weather Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 992px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background-color: #1e293b;
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--algeria-green);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #64748b;
            font-size: 1rem;
        }

        /* Weather Tips */
        .tips-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 992px) {
            .tips-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .tips-container {
                grid-template-columns: 1fr;
            }
        }

        .tip-card {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .tip-card {
            background-color: #1e293b;
        }

        .tip-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--success-green);
        }

        .tip-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--algeria-green);
        }

        /* Footer */
        footer {
            background-color: var(--algeria-green);
            color: white;
            padding: 3rem 2rem 1.5rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (max-width: 992px) {
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: white;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column ul li a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .social-links a:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            .search-container input {
                width: 200px;
            }

            main {
                padding: 0 1rem;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Chart Container */
        .chart-container {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
            height: 400px;
        }

        .dark-mode .chart-container {
            background-color: #1e293b;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            nav {
                width: 100%;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }

            nav.active {
                max-height: 300px;
            }

            nav ul {
                flex-direction: column;
                padding-top: 1rem;
            }
        }

        /* API Status */
        .api-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--algeria-green);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .api-status.error {
            background-color: var(--algeria-red);
        }

        /* City Suggestions */
        .city-suggestions {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }

        .dark-mode .city-suggestions {
            background-color: #1e293b;
            color: white;
        }

        .city-suggestion-item {
            padding: 0.7rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #e2e8f0;
        }

        .city-suggestion-item {
            font-size: 1.1rem;
            padding: 0.8rem 1rem;
            background: #ffffff;
            color: #111;
            border-bottom: 1px solid #eee;
        }

        .city-suggestions {
            border: 1px solid #d0d0d0;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(6px);
        }


        .dark-mode .city-suggestion-item {
            border-bottom-color: #334155;
        }

        .city-suggestion-item:hover {
            background-color: #f1f5f9;
        }

        .dark-mode .city-suggestion-item:hover {
            background-color: #334155;
        }

        /* Hourly Forecast */
        .hourly-forecast {
            overflow-x: auto;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .hourly-container {
            display: flex;
            gap: 1rem;
            min-width: 100%;
        }

        .hourly-card {
            min-width: 120px;
            background-color: white;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .hourly-card {
            background-color: #1e293b;
        }

        .hourly-time {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--algeria-green);
        }

        /* News Grid */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .news-card {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }

        .dark-mode .news-card {
            background-color: #1e293b;
        }

        .news-card:hover {
            transform: translateY(-5px);
        }

        .news-image {
            height: 180px;
            overflow: hidden;
        }

        .news-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .news-card:hover .news-image img {
            transform: scale(1.05);
        }

        .news-content {
            padding: 1.5rem;
        }

        .news-content h3 {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: var(--algeria-green);
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #64748b;
        }

        /* إضافة هذا الكود في قسم CSS */

        .location-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .location-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .location-btn:active {
            transform: scale(0.95);
        }

        .location-btn.loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .location-btn.error {
            color: var(--algeria-red);
        }

        .location-btn.success {
            color: #4ade80;
        }

        /* تحسين التصميم للجوال */
        @media (max-width: 768px) {
            .location-btn {
                font-size: 1.3rem;
                width: 36px;
                height: 36px;
            }
        }

        #toTopBtn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 50px;
            height: 50px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 50%;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            opacity: 0;
            visibility: hidden;
            transition: 0.3s ease;
            z-index: 99999;
        }

        #toTopBtn.show {
            opacity: 1;
            visibility: visible;
        }


        #toTopBtn:hover {
            transform: scale(1.1);
            background: #0078d4;
        }

        .logo-icon {
            width: 40px;
            /* عرض الصورة */
            height: 40px;
            /* ارتفاع الصورة */
            border-radius: 50%;
            /* يجعل الصورة دائرية */
            object-fit: cover;
            /* لضمان ملء الدائرة بشكل متناسق */
            border: 2px solid white;
            /* اختياري: لإضافة إطار حول الدائرة */
        }

        /* أضف إلى CSS الموجود */
        #seaState {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>

    <style>
        /* تحسينات لقسم حالة البحر */
        .sea-forecast {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .dark-mode .sea-forecast {
            background-color: #1e293b;
        }

        .sea-forecast h2 {
            font-size: 1.8rem;
            color: var(--algeria-green);
            margin-bottom: 1.5rem;
            position: relative;
            padding-right: 1rem;
        }

        .sea-forecast h2::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: -5px;
            width: 50px;
            height: 3px;
            background-color: var(--algeria-green);
        }

        .sea-forecast .weather-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .sea-forecast .weather-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .sea-forecast .weather-details {
                grid-template-columns: 1fr;
            }
        }

        .sea-forecast .detail-item {
            background: linear-gradient(135deg, #1a56db, #3b82f6);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sea-forecast .detail-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .sea-forecast .detail-item i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .sea-forecast .detail-item .detail-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .sea-forecast .detail-item .detail-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* ألوان مختلفة لكل عنصر */
        .sea-forecast .detail-item:nth-child(1) {
            background: linear-gradient(135deg, #0e7490, #06b6d4);
        }

        .sea-forecast .detail-item:nth-child(2) {
            background: linear-gradient(135deg, #7c3aed, #8b5cf6);
        }

        .sea-forecast .detail-item:nth-child(3) {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        /* حالة عدم توفر البيانات */
        .sea-forecast .detail-item.no-data {
            background: linear-gradient(135deg, #6b7280, #9ca3af);
            grid-column: 1 / -1;
        }

        .sea-forecast .detail-item.no-data i {
            font-size: 3rem;
        }

        .sea-forecast .detail-item.no-data .detail-value {
            font-size: 1.5rem;
            margin-top: 0.5rem;
        }

        /* مؤشرات للقيم */
        .wave-indicator {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .wave-indicator-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* تلميحات إضافية */
        .sea-tips {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sea-tips h4 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: white;
        }

        .sea-tips ul {
            list-style: none;
            padding-right: 1rem;
        }

        .sea-tips li {
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sea-tips li i {
            color: #fbbf24;
        }

        /* تحسينات للوضع الداكن */
        .dark-mode .sea-forecast .detail-item {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .sea-forecast .detail-item:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* تأثيرات خاصة للأمواج */
        @keyframes wave-animation {

            0%,
            100% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(-10px);
            }
        }

        .sea-forecast .detail-item:nth-child(1) i {
            animation: wave-animation 2s ease-in-out infinite;
        }

        /* تنسيق container */
        #weatherTips {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
            margin-top: 2rem;
        }

        /* بطاقة كل نصيحة */
        #weatherTips .tip-card {
            background: linear-gradient(145deg, #ffffff, #f0f4f8);
            border-radius: 15px;
            padding: 1.2rem 1rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
            cursor: default;
        }

        /* تأثير hover */
        #weatherTips .tip-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
            background: linear-gradient(145deg, #f0f8ff, #e0f0ff);
        }

        /* أيقونة النصيحة */
        #weatherTips .tip-icon {
            font-size: 2.5rem;
            margin-bottom: 0.7rem;
            color: #10b981;
            background: linear-gradient(135deg, #d1fae5, #10b981);
            width: 60px;
            height: 60px;
            line-height: 60px;
            border-radius: 50%;
            display: inline-block;
            transition: transform 0.3s, background 0.3s;
        }

        /* تأثير عند hover */
        #weatherTips .tip-card:hover .tip-icon {
            transform: scale(1.2) rotate(10deg);
            background: linear-gradient(135deg, #a7f3d0, #059669);
        }

        /* عنوان النصيحة */
        #weatherTips .tip-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.6rem;
            color: #1e3a8a;
        }

        /* نص النصيحة */
        #weatherTips p {
            font-size: 0.95rem;
            color: #334155;
            line-height: 1.4;
        }
    </style>
</head>

<body>
    <!-- API Status Indicator -->
    <div class="api-status" id="apiStatus">
        <i class="fas fa-check-circle"></i>
        <span>API Connected</span>
    </div>

    <!-- Alert Banner -->
    <div class="alert-banner" id="alertBanner">
        <span id="alertText">جاري تحميل بيانات الطقس للجزائر...</span>
        <button class="alert-close" id="closeAlert">&times;</button>
    </div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <div class="algeria-flag"></div>
                <img src="images/icon1.webp" alt="طقس" class="logo-icon">
                <h1>الطقس الجزائري</h1>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>

            <nav id="mainNav">
                <ul>
                    <li><a href="#home" class="active">الرئيسية</a></li>
                    <li><a href="#forecast">التنبؤات</a></li>
                    <li><a href="#maps">الخرائط</a></li>
                    <li><a href="#news">الأخبار</a></li>
                    <li><a href="#gallery">معرض الصور</a></li>
                    <li><a href="#contact">اتصل بنا</a></li>
                </ul>
            </nav>

            <div class="header-controls">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="ابحث عن مدينة ...">
                    <div class="city-suggestions hidden" id="citySuggestions"></div>
                </div>

                <!-- زر تحديد الموقع الجغرافي -->
                <button class="location-btn" id="locationBtn" title="تحديد موقعك الحالي">
                    <i class="fas fa-location-crosshairs"></i>
                </button>

                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>

            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero-section" id="home">
            <div class="current-weather" id="currentWeather">
                <div class="weather-header">
                    <div class="location">
                        <h2 id="currentCity">الجزائر العاصمة، الجزائر</h2>
                        <div class="last-update">آخر تحديث: <span id="updateTime">--:--</span></div>
                    </div>
                    <div class="weather-actions">
                        <button class="btn" id="refreshWeather">
                            <i class="fas fa-sync-alt"></i> تحديث
                        </button>
                    </div>
                </div>

                <div class="current-temp">
                    <div class="temp-main">
                        <div class="temp" id="currentTemp">--°</div>
                        <div class="condition" id="currentCondition">جاري التحميل...</div>
                    </div>
                    <div class="weather-icon" id="weatherIcon">
                        <i class="fas fa-sun"></i>
                    </div>
                </div>

                <div class="weather-details" id="weatherDetails">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>

                <!-- قسم النصائح الديناميكي -->
                <div class="tips-container" id="weatherTips">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
            </div>

            <div class="news-ticker">
                <div class="ticker-header">
                    <h3>آخر الأخبار الجوية</h3>
                    <span class="live-badge">مباشر</span>
                </div>
                <div class="news-source-controls">
                    <button class="btn active" data-source="newsapi">
                        <i class="fas fa-newspaper"></i> أخبار عالمية
                    </button>
                    <button class="btn" data-source="local">
                        <i class="fas fa-map-marker-alt"></i> أخبار محلية
                    </button>
                    <button class="btn" data-source="alerts">
                        <i class="fas fa-exclamation-triangle"></i> تحذيرات
                    </button>
                </div>

                <div class="ticker-content" id="newsTicker"></div>
                <div class="news-grid" id="newsGrid"></div>
                <button class="btn" id="refreshNews">تحديث الأخبار</button>
            </div>
        </section>

        <!-- Hourly Forecast -->
        <section>
            <div class="section-header">
                <h2>تنبؤات 24 ساعة القادمة</h2>
            </div>

            <div class="hourly-forecast">
                <div class="hourly-container" id="hourlyForecast">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
            </div>
        </section>

        <!-- حالة البحر -->
        <section>
            <div class="sea-forecast">
                <h2>حالة البحر</h2>
            </div>
            <div class="sea-forecast">
                <div class="weather-details" id="weatherDetails"></div>
                <!-- سيتم ملؤها بواسطة JavaScript -->
                <div class="weather-details" id="seaState"></div>
            </div>
            </div>
        </section>

        <!-- 7-Day Forecast -->
        <section id="forecast">
            <div class="section-header">
                <h2>تنبؤات 7 أيام القادمة</h2>
                <button class="btn" id="viewFullForecast">عرض التفاصيل الكاملة</button>
            </div>

            <div class="forecast-container" id="forecastContainer">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
        </section>

        <!-- Weather Map -->
        <section id="maps">
            <div class="section-header">
                <h2>خريطة الطقس التفاعلية</h2>
                <div class="map-controls">
                    <button class="map-btn active" data-layer="temperature">🌡️ درجة الحرارة</button>
                    <button class="map-btn" data-layer="precipitation">💧 هطول الأمطار</button>
                    <button class="map-btn" data-layer="wind">💨 سرعة الرياح</button>
                    <button class="map-btn" data-layer="clouds">☁️ الغطاء السحابي</button>
                </div>
            </div>

            <div class="weather-map-container">
                <div class="map-wrapper">
                    <div id="weatherMap"></div>
                </div>
            </div>

            <div id="mapLegend" class="map-legend">
                <!-- سيتم ملء المفتاح ديناميكياً حسب الطبقة -->
            </div>
        </section>

        <!-- Temperature Chart -->
        <section>
            <div class="section-header">
                <h2>مخطط درجات الحرارة للأسبوع</h2>
            </div>

            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
        </section>

        <!-- Weather Statistics -->
        <section>
            <div class="section-header">
                <h2>إحصائيات الطقس الحالية</h2>
            </div>

            <div class="stats-grid" id="statsGrid">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
        </section>

        <!-- News Section -->
        <div class="section-header">
            <h2>أخبار الطقس والمناخ</h2>

            <div style="display:flex; gap:10px;">
                <button class="btn" id="localNewsBtn">الأخبار المحلية</button>
                <button class="btn" id="alertsBtn">التنبيهات الجوية</button>
                <button class="btn" id="refreshNews">تحديث</button>
            </div>
        </div>


        <!-- Gallery -->
        <section id="gallery">
            <div class="section-header">
                <h2>معرض الصور الجوية</h2>
                <button class="btn" id="uploadPhoto">رفع صورة</button>
            </div>

            <div class="gallery-container">
                <div class="gallery-grid" id="galleryGrid">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
            </div>
        </section>

        <!-- Weather Tips -->
        <section>
            <div class="section-header">
                <h2>نصائح طقسية</h2>
            </div>

            <div class="tips-container">
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <h3 class="tip-title">حماية من الشمس</h3>
                    <p>مؤشر الأشعة فوق البنفسجية مرتفع اليوم. استخدم واقي الشمس وارتدي نظارات شمسية وقبعة للحماية.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <h3 class="tip-title">ترطيب الجسم</h3>
                    <p>اشرب 8-10 أكواب من الماء يومياً خاصة مع ارتفاع درجات الحرارة لتجنب الجفاف.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-umbrella"></i>
                    </div>
                    <h3 class="tip-title">استعد للأمطار</h3>
                    <p>توقعات بهطول أمطار غداً. احمل مظلتك وتجنب القيادة في المناطق المنخفضة.</p>
                </div>
            </div>
        </section>
    </main>

    <button id="toTopBtn" title="الرجوع للأعلى">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Footer -->
    <footer id="contact">
        <div class="footer-content">
            <div class="footer-column">
                <h3>الطقس الجزائري</h3>
                <p>منصة متكاملة للتنبؤات الجوية المباشرة للجزائر باستخدام OpenWeatherMap API وخرائط Leaflet التفاعلية.
                </p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>

            <div class="footer-column">
                <h3>مدن رئيسية</h3>
                <ul>
                    <li><a href="#" data-city="Algiers">الجزائر العاصمة</a></li>
                    <li><a href="#" data-city="Oran">وهران</a></li>
                    <li><a href="#" data-city="Constantine">قسنطينة</a></li>
                    <li><a href="#" data-city="Annaba">عنابة</a></li>
                    <li><a href="#" data-city="Blida">البليدة</a></li>
                    <li><a href="#" data-city="Setif">سطيف</a></li>
                    <li><a href="#" data-city="Tamanrasset">تمنراست</a></li>

                </ul>
            </div>

            <div class="footer-column">
                <h3>خدماتنا</h3>
                <ul>
                    <li><a href="#forecast">تنبؤات الطقس</a></li>
                    <li><a href="#maps">خرائط تفاعلية</a></li>
                    <li><a href="#news">أخبار الطقس</a></li>
                    <li><a href="#gallery">معرض الصور</a></li>
                    <li><a href="#">تنبيهات الطقس</a></li>
                    <li><a href="https://imadtbn.github.io/dz_portal/" target="_blank">
                            البوابة الجزائرية للخدمات الرقمية
                        </a>
                </ul>
                </ul>
            </div>

            <div class="footer-column">
                <h3>اتصل بنا</h3>
                <ul>
                    <li><i class="fas fa-map-marker-alt"></i> الجزائر العاصمة</li>
                    <li><i class="fas fa-phone"></i> +213 21 123 4567</li>
                    <li><i class="fas fa-envelope"></i> info@algeria-weather.dz</li>
                    <li><i class="fas fa-clock"></i> 24/7 دعم على مدار الساعة</li>
                </ul>
            </div>
        </div>

        <div class="copyright">
            <p>© 2025 الطقس الجزائري. جميع الحقوق محفوظة.</p>
            <p>بيانات الطقس مقدمة من <a href="https://openweathermap.org" style="color:#fff;">OpenWeatherMap</a> | خرائط
                من <a href="https://leafletjs.com" style="color:#fff;">Leaflet</a></p>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- إضافة هذا الكود بعد Leaflet JS وقبل </body> -->

    <script>
        // API Keys
        const OPENWEATHER_API_KEY = '1151122405b6f7be33bf0de4b22bb5a4';
        const NEWS_API_KEY = 'pub_0717253193ed4849a7be65b3c49eb1fa';

        // المتغيرات العامة
        let currentLocation = { lat: 36.752887, lon: 3.042048 }; // إحداثيات الجزائر العاصمة
        let currentCity = "الجزائر العاصمة";
        let weatherMap = null;
        let currentLayer = 'temperature';
        let temperatureChart = null;
        let currentWeatherData = null;

        // DOM Elements
        const apiStatus = document.getElementById('apiStatus');
        const alertBanner = document.getElementById('alertBanner');
        const alertText = document.getElementById('alertText');
        const closeAlert = document.getElementById('closeAlert');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mainNav = document.getElementById('mainNav');
        const searchInput = document.getElementById('searchInput');
        const citySuggestions = document.getElementById('citySuggestions');
        const locationBtn = document.getElementById('locationBtn');
        const themeToggle = document.getElementById('themeToggle');
        const currentCityElement = document.getElementById('currentCity');
        const updateTimeElement = document.getElementById('updateTime');
        const currentTemp = document.getElementById('currentTemp');
        const currentCondition = document.getElementById('currentCondition');
        const weatherIcon = document.getElementById('weatherIcon');
        const weatherDetails = document.getElementById('weatherDetails');
        const refreshWeather = document.getElementById('refreshWeather');
        const hourlyForecast = document.getElementById('hourlyForecast');
        const forecastContainer = document.getElementById('forecastContainer');
        const weatherMapElement = document.getElementById('weatherMap');
        const temperatureChartElement = document.getElementById('temperatureChart');
        const statsGrid = document.getElementById('statsGrid');
        const newsTicker = document.getElementById('newsTicker');
        const newsGrid = document.getElementById('newsGrid');
        const refreshNews = document.getElementById('refreshNews');
        const galleryGrid = document.getElementById('galleryGrid');
        const viewFullForecast = document.getElementById('viewFullForecast');
        const uploadPhoto = document.getElementById('uploadPhoto');

        // قائمة المدن الجزائرية للبحث
        const algerianCities = [
            { name: "الجزائر العاصمة", lat: 36.752887, lon: 3.042048 },
            { name: "وهران", lat: 35.697654, lon: -0.633737 },
            { name: "قسنطينة", lat: 36.365, lon: 6.614722 },
            { name: "عنابة", lat: 36.9, lon: 7.766667 },
            { name: "البليدة", lat: 36.483333, lon: 2.833333 },
            { name: "سطيف", lat: 36.191944, lon: 5.413611 },
            { name: "تيزي وزو", lat: 36.716667, lon: 4.05 },
            { name: "باتنة", lat: 35.55, lon: 6.166667 },
            { name: "الشلف", lat: 36.166667, lon: 1.333333 },
            { name: "تلمسان", lat: 34.882778, lon: -1.316667 },
            { name: "بجاية", lat: 36.75, lon: 5.083333 },
            { name: "بشار", lat: 31.616667, lon: -2.216667 },
            { name: "ورقلة", lat: 31.95, lon: 5.316667 },
            { name: "تمنراست", lat: 22.785, lon: 5.522778 }
        ];

        // تهيئة التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        // دالة تهيئة التطبيق
        async function initApp() {
            showAlert('جارٍ تحميل بيانات الطقس...', 'info');

            // إضافة Event Listeners
            setupEventListeners();

            // تهيئة الخريطة
            initMap();

            // جلب بيانات الطقس الحالي
            await fetchWeatherData();

            // جلب الأخبار
            await fetchWeatherNews();

            // تحميل معرض الصور
            loadGallery();

            // اختبار اتصال API
            testAPIConnection();

            hideAlert();
        }

        // إعداد Event Listeners
        function setupEventListeners() {
            // زر القائمة المتنقلة
            mobileMenuBtn.addEventListener('click', () => {
                mainNav.classList.toggle('active');
            });

            // إغلاق التنبيه
            closeAlert.addEventListener('click', hideAlert);

            // تغيير الوضع (فاتح/داكن)
            themeToggle.addEventListener('click', toggleTheme);

            // تحديث الطقس
            refreshWeather.addEventListener('click', fetchWeatherData);

            // تحديث الأخبار
            refreshNews.addEventListener('click', fetchWeatherNews);

            // البحث عن مدينة
            searchInput.addEventListener('input', handleSearchInput);
            searchInput.addEventListener('focus', () => {
                if (searchInput.value.length > 0) {
                    searchCities(searchInput.value);
                }
            });

            // تحديد الموقع الجغرافي
            locationBtn.addEventListener('click', getCurrentLocation);

            // النقر على روابط المدن في الفوتر
            document.querySelectorAll('[data-city]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const cityKey = e.target.dataset.city;
                    const cityName = cityMap[cityKey];
                    const city = algerianCities.find(c => c.name === cityName);
                    if (city) {
                        searchInput.value = city.name;
                        updateWeatherForCity(city);
                    }
                });
            });
            const cityMap = {
                "Algiers": "الجزائر العاصمة",
                "Oran": "وهران",
                "Constantine": "قسنطينة",
                "Annaba": "عنابة",
                "Blida": "البليدة",
                "Setif": "سطيف",
                "Tamanrasset": "تمنراست"
            };

            // أزرار التحكم في الخريطة
            document.querySelectorAll('.map-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentLayer = this.dataset.layer;
                    updateMapLayer();
                });
            });

            // عرض التنبؤات الكاملة
            viewFullForecast.addEventListener('click', () => {
                alert('سيتم فتح صفحة التنبؤات الكاملة قريباً');
            });

            // رفع صورة
            uploadPhoto.addEventListener('click', () => {
                alert('ميزة رفع الصور قيد التطوير');
            });

            // التنقل السلس
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function (e) {
                    if (this.getAttribute('href').startsWith('#')) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href').substring(1);
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth' });
                            // تحديث القائمة النشطة
                            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                            this.classList.add('active');
                        }
                    }
                });
            });
        }

        // جلب بيانات الطقس
        async function fetchWeatherData() {
            try {
                showLoading(locationBtn);

                // جلب الطقس الحالي
                const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${currentLocation.lat}&lon=${currentLocation.lon}&units=metric&appid=${OPENWEATHER_API_KEY}&lang=ar`;
                const weatherResponse = await fetch(weatherUrl);
                const weatherData = await weatherResponse.json();

                if (!weatherResponse.ok) throw new Error(weatherData.message);

                currentWeatherData = weatherData;
                updateCurrentWeather(weatherData);
                updateWeatherTips(weatherData);
                loadGalleryDynamic(weatherData.weather[0].id);



                // جلب توقعات 5 أيام (كل 3 ساعات)
                const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${currentLocation.lat}&lon=${currentLocation.lon}&units=metric&appid=${OPENWEATHER_API_KEY}&lang=ar`;
                const forecastResponse = await fetch(forecastUrl);
                const forecastData = await forecastResponse.json();

                if (!forecastResponse.ok) throw new Error(forecastData.message);

                // تحديث توقعات 24 ساعة
                updateHourlyForecast(forecastData);

                // تحديث توقعات 7 أيام
                update7DayForecast(forecastData);

                // تحديث الإحصائيات
                updateWeatherStats(weatherData);

                // تحديث الرسم البياني
                updateTemperatureChart(forecastData);

                // جلب بيانات حالة البحر (إن كانت متاحة)
                // ملاحظة: قد تحتاج API متميزة لهذه الميزة
                try {
                    await fetchMarineData(currentLocation.lat, currentLocation.lon);
                } catch (marineError) {
                    console.warn('Could not fetch marine data:', marineError);
                    // لا توقف التطبيق إذا فشل طلب بيانات البحر
                    updateMarineConditions(null);
                }

                // تحديث وقت التحديث
                updateTimeElement.textContent = new Date().toLocaleTimeString('ar-DZ');

                showSuccess(locationBtn);

            } catch (error) {
                console.error('Error fetching weather data:', error);
                showAlert(`خطأ في جلب بيانات الطقس: ${error.message}`, 'error');
                showError(locationBtn);
            } finally {
                hideLoading(locationBtn);
            }
        }

        // دالة منفصلة لجلب بيانات البحر
        async function fetchMarineData(lat, lon) {
            try {
                // استخدم One Call API بدلاً من Marine API إذا لم تكن متاحة
                const marineUrl = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=current,minutely,hourly,daily,alerts&appid=${OPENWEATHER_API_KEY}&units=metric`;
                const marineResponse = await fetch(marineUrl);

                if (!marineResponse.ok) {
                    throw new Error(`Marine API error: ${marineResponse.status}`);
                }

                const marineData = await marineResponse.json();
                updateMarineConditions(marineData);
            } catch (error) {
                // في حالة الفشل، استخدم بيانات افتراضية أو اتركها فارغة
                console.warn('Using fallback marine data:', error);
                updateMarineConditions({
                    wave_height: 1.2,
                    wave_direction: 45,
                    wave_period: 6.5
                });
            }
        }

        // تحديث حالة البحر مع معالجة الحالات الفارغة
        function updateMarineConditions(data) {
            const seaStateElement = document.getElementById("seaState");

            if (!seaStateElement) {
                console.error('seaState element not found');
                return;
            }

            if (!data) {
                // حالة البيانات غير متوفرة
                seaStateElement.innerHTML = `
            <div class="detail-item">
                <i class="fas fa-water"></i>
                <div class="detail-value">غير متوفر</div>
                <div class="detail-label">حالة البحر</div>
            </div>
        `;
                return;
            }

            // استخدام بيانات افتراضية إذا كانت البيانات غير مكتملة
            const wave = data.wave_height || data.current?.wave_height || 0;
            const waveDir = data.wave_direction || data.current?.wave_direction || 0;
            const wavePeriod = data.wave_period || data.current?.wave_period || 0;

            seaStateElement.innerHTML = `
        <div class="detail-item">
            <i class="fas fa-water"></i>
            <div class="detail-value">${wave.toFixed(1)} م</div>
            <div class="detail-label">ارتفاع الموج</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-compass"></i>
            <div class="detail-value">${waveDir}°</div>
            <div class="detail-label">اتجاه الموج</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-clock"></i>
            <div class="detail-value">${wavePeriod.toFixed(1)} ث</div>
            <div class="detail-label">فترة الموج</div>
        </div>
    `;
        }

        // إذا كان One Call API غير متاح، استخدم تنبؤات الرياح كبديل
        function getAlternativeMarineData(weatherData) {
            return {
                wave_height: calculateWaveHeight(weatherData.wind.speed),
                wave_direction: weatherData.wind.deg || 0,
                wave_period: calculateWavePeriod(weatherData.wind.speed)
            };
        }

        function calculateWaveHeight(windSpeed) {
            // معادلة مبسطة لتقدير ارتفاع الأمواج بناءً على سرعة الرياح
            return windSpeed * 0.2; // متر
        }

        function calculateWavePeriod(windSpeed) {
            // معادلة مبسطة لفترة الأمواج
            return windSpeed * 0.3; // ثواني
        }

        // تحديث بيانات الطقس الحالي
        function updateCurrentWeather(data) {
            currentCityElement.textContent = `${data.name}، الجزائر`;
            currentTemp.textContent = `${Math.round(data.main.temp)}°C`;
            currentCondition.textContent = data.weather[0].description;

            // مولّد أسماء الدول بالعربية
            const regionNames = new Intl.DisplayNames(['ar'], { type: 'region' });

            // الحصول على اسم الدولة ديناميكيا
            const countryName = regionNames.of(data.sys.country);

            // عرض المدينة + الدولة
            currentCityElement.textContent = `${data.name}، ${countryName}`;

            // تحديث الأيقونة
            updateWeatherIcon(data.weather[0].id, data.weather[0].icon);

            // تحديث التفاصيل
            const details = [
                { icon: 'fas fa-temperature-high', label: 'الاحساس', value: `${Math.round(data.main.feels_like)}°C` },
                { icon: 'fas fa-tint', label: 'الرطوبة', value: `${data.main.humidity}%` },
                { icon: 'fas fa-wind', label: 'الرياح', value: `${Math.round(data.wind.speed * 3.6)} كم/س` },
                { icon: 'fas fa-compress-alt', label: 'الضغط', value: `${data.main.pressure} هكتوباسكال` }
            ];

            weatherDetails.innerHTML = details.map(detail => `
            <div class="detail-item">
                <i class="${detail.icon}"></i>
                <div class="detail-value">${detail.value}</div>
                <div class="detail-label">${detail.label}</div>
            </div>
        `).join('');
        }

        function updateMarineConditions(data) {
            const seaStateElement = document.getElementById("seaState");

            if (!seaStateElement) {
                console.error('seaState element not found');
                return;
            }

            // تنظيف المحتوى السابق
            seaStateElement.innerHTML = '';

            if (!data || (!data.wave_height && !data.wave_direction && !data.wave_period)) {
                // حالة عدم توفر البيانات
                seaStateElement.innerHTML = `
            <div class="detail-item no-data">
                <i class="fas fa-water"></i>
                <div class="detail-value">بيانات البحر غير متوفرة</div>
                <div class="detail-label">سيتم تحديثها قريباً</div>
            </div>
        `;
                return;
            }

            // عرض البيانات المتوفرة
            let html = '';

            if (data.wave_height !== undefined) {
                const waveHeight = parseFloat(data.wave_height);
                const wavePercentage = Math.min((waveHeight / 5) * 100, 100); // افتراض أن 5m هو الحد الأقصى
                html += `
            <div class="detail-item">
                <i class="fas fa-water"></i>
                <div class="detail-value">${waveHeight.toFixed(1)} م</div>
                <div class="detail-label">ارتفاع الموج</div>
                <div class="wave-indicator">
                    <div class="wave-indicator-fill" style="width: ${wavePercentage}%"></div>
                </div>
            </div>
        `;
            }

            if (data.wave_direction !== undefined) {
                const direction = parseInt(data.wave_direction);
                const directionText = getWindDirection(direction);
                html += `
            <div class="detail-item">
                <i class="fas fa-compass" style="transform: rotate(${direction}deg)"></i>
                <div class="detail-value">${directionText}</div>
                <div class="detail-label">اتجاه الموج</div>
                <div class="detail-sub">${direction}°</div>
            </div>
        `;
            }

            if (data.wave_period !== undefined) {
                const period = parseFloat(data.wave_period);
                html += `
            <div class="detail-item">
                <i class="fas fa-clock"></i>
                <div class="detail-value">${period.toFixed(1)} ث</div>
                <div class="detail-label">فترة الموج</div>
            </div>
        `;
            }

            // إضافة تلميحات حسب حالة البحر
            if (data.wave_height) {
                const tips = getSeaTips(data.wave_height);
                if (tips) {
                    html += `
                <div class="sea-tips">
                    <h4>توصيات:</h4>
                    <ul>
                        ${tips.map(tip => `<li><i class="fas fa-info-circle"></i> ${tip}</li>`).join('')}
                    </ul>
                </div>
            `;
                }
            }

            seaStateElement.innerHTML = html;
        }

        // دالة مساعدة للحصول على اتجاه الرياح
        function getWindDirection(degrees) {
            const directions = ['شمال', 'شمال شرق', 'شرق', 'جنوب شرق', 'جنوب', 'جنوب غرب', 'غرب', 'شمال غرب'];
            const index = Math.round((degrees % 360) / 45) % 8;
            return directions[index];
        }

        // دالة مساعدة للحصول على تلميحات حسب ارتفاع الأمواج
        function getSeaTips(waveHeight) {
            if (waveHeight < 0.5) {
                return ['البحر هادئ جداً', 'مثالي للسباحة والأنشطة البحرية'];
            } else if (waveHeight < 1.5) {
                return ['الهادئ إلى متوسط', 'مناسب لمعظم الأنشطة البحرية'];
            } else if (waveHeight < 2.5) {
                return ['البحر مضطرب', 'احذر عند السباحة', 'غير مناسب للقوارب الصغيرة'];
            } else {
                return ['البحر عالي الموج', 'تجنب الأنشطة البحرية', 'خطر على السباحة'];
            }
        }

        // تحديث أيقونة الطقس
        function updateWeatherIcon(weatherId, iconCode) {
            let iconClass = 'fas fa-sun';
            let iconColor = '#f59e0b';

            if (weatherId >= 200 && weatherId < 300) {
                iconClass = 'fas fa-bolt'; // عواصف رعدية
                iconColor = '#7c3aed';
            } else if (weatherId >= 300 && weatherId < 500) {
                iconClass = 'fas fa-cloud-rain'; // رذاذ
                iconColor = '#3b82f6';
            } else if (weatherId >= 500 && weatherId < 600) {
                iconClass = 'fas fa-cloud-showers-heavy'; // مطر
                iconColor = '#1d4ed8';
            } else if (weatherId >= 600 && weatherId < 700) {
                iconClass = 'fas fa-snowflake'; // ثلج
                iconColor = '#60a5fa';
            } else if (weatherId >= 700 && weatherId < 800) {
                iconClass = 'fas fa-smog'; // ضباب
                iconColor = '#94a3b8';
            } else if (weatherId === 800) {
                iconClass = iconCode.includes('d') ? 'fas fa-sun' : 'fas fa-moon';
                iconColor = iconCode.includes('d') ? '#f59e0b' : '#64748b';
            } else if (weatherId > 800) {
                iconClass = 'fas fa-cloud';
                iconColor = '#94a3b8';
            }

            weatherIcon.innerHTML = `<i class="${iconClass}"></i>`;
            weatherIcon.style.color = iconColor;
        }

        // تحديث توقعات 24 ساعة
        function updateHourlyForecast(data) {
            const hourlyData = data.list.slice(0, 8); // أول 8 فترات (24 ساعة)

            hourlyForecast.innerHTML = hourlyData.map(item => {
                const time = new Date(item.dt * 1000);
                const hour = time.getHours();
                const temp = Math.round(item.main.temp);
                const icon = getWeatherIcon(item.weather[0].id, hour);

                return `
                <div class="hourly-card">
                    <div class="hourly-time">${hour}:00</div>
                    <div class="hourly-icon" style="font-size: 2rem; margin: 0.5rem 0;">
                        <i class="${icon}"></i>
                    </div>
                    <div class="hourly-temp">${temp}°</div>
                </div>
            `;
            }).join('');
        }

        // تحديث توقعات 7 أيام
        function update7DayForecast(data) {
            // تجميع البيانات حسب اليوم
            const dailyData = {};
            const days = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];

            data.list.forEach(item => {
                const date = new Date(item.dt * 1000);
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const dateString = `${day}/${month}`;

                if (!dailyData[dateString]) {
                    dailyData[dateString] = {
                        temps: [],
                        conditions: [],
                        date: date
                    };
                }

                dailyData[dateString].temps.push(item.main.temp);
                dailyData[dateString].conditions.push(item.weather[0].id);
            });

            // إنشاء بطاقات الأيام السبعة
            const dailyCards = Object.entries(dailyData).slice(0, 7).map(([dateString, dayData]) => {
                const avgTemp = dayData.temps.reduce((a, b) => a + b, 0) / dayData.temps.length;
                const maxTemp = Math.max(...dayData.temps);
                const minTemp = Math.min(...dayData.temps);
                const dayName = days[dayData.date.getDay()];
                const mostCommonCondition = getMostCommon(dayData.conditions);
                const icon = getWeatherIcon(mostCommonCondition, 12);

                return `
                <div class="forecast-card">
                    <div class="forecast-day">${dayName}</div>
                    <div class="forecast-date">${dateString}</div>
                    <div class="forecast-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="forecast-temp">
                        <span class="high-temp">${Math.round(maxTemp)}°</span>
                        <span class="low-temp">${Math.round(minTemp)}°</span>
                    </div>
                </div>
            `;
            }).join('');

            forecastContainer.innerHTML = dailyCards;
        }

        // تحديث الإحصائيات
        function updateWeatherStats(data) {
            const stats = [
                { icon: 'fas fa-thermometer-half', value: `${Math.round(data.main.temp_max)}°C`, label: 'الحد الأقصى' },
                { icon: 'fas fa-thermometer-quarter', value: `${Math.round(data.main.temp_min)}°C`, label: 'الحد الأدنى' },
                { icon: 'fas fa-eye', value: `${data.visibility / 1000} كم`, label: 'الرؤية' },
                { icon: 'fas fa-cloud-sun', value: `${data.clouds.all}%`, label: 'الغيوم' }
            ];

            statsGrid.innerHTML = stats.map(stat => `
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="${stat.icon}"></i>
                </div>
                <div class="stat-value">${stat.value}</div>
                <div class="stat-label">${stat.label}</div>
            </div>
        `).join('');
        }

        // تحديث الرسم البياني
        // تحديث الرسم البياني مع درجات الحرارة العليا والدنيا وعرض القيم
        function updateTemperatureChart(data) {
            const ctx = temperatureChartElement.getContext('2d');

            const labels = [];
            const maxTemps = [];
            const minTemps = [];

            // تجميع بيانات 7 أيام
            const dailyData = {};

            data.list.forEach(item => {
                const date = new Date(item.dt * 1000);
                const dayString = date.toLocaleDateString('ar-DZ', { weekday: 'short' });

                if (!dailyData[dayString]) {
                    dailyData[dayString] = { temps: [] };
                }
                dailyData[dayString].temps.push(item.main.temp);
            });

            let dayCount = 0;
            for (const [day, info] of Object.entries(dailyData)) {
                if (dayCount >= 7) break;
                labels.push(day);
                maxTemps.push(Math.round(Math.max(...info.temps)));
                minTemps.push(Math.round(Math.min(...info.temps)));
                dayCount++;
            }

            if (temperatureChart) {
                temperatureChart.destroy();
            }

            temperatureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'درجة الحرارة العليا',
                            data: maxTemps,
                            borderColor: '#dc2626', // أحمر
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            pointBackgroundColor: '#dc2626',
                            pointBorderColor: '#fff',
                            datalabels: {
                                align: 'top',
                                anchor: 'end',
                                color: '#dc2626',
                                font: { weight: 'bold', size: 12 }
                            }
                        },
                        {
                            label: 'درجة الحرارة الدنيا',
                            data: minTemps,
                            borderColor: '#3b82f6', // أزرق
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#fff',
                            datalabels: {
                                align: 'bottom',
                                anchor: 'start',
                                color: '#3b82f6',
                                font: { weight: 'bold', size: 12 }
                            }
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        tooltip: {
                            enabled: true,
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function (context) {
                                    return context.dataset.label + ': ' + context.parsed.y + '°C';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                callback: function (value) {
                                    return value + '°C';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels] // تأكد من إضافة مكتبة ChartDataLabels
            });
        }

        // جلب أخبار الطقس
        async function fetchWeatherNews() {
            try {
                showAlert('جارٍ تحميل الأخبار...', 'info');

                const newsSources = document.querySelectorAll('.news-source-controls .btn');
                let activeSource = 'newsapi';

                newsSources.forEach(btn => {
                    if (btn.classList.contains('active')) {
                        activeSource = btn.dataset.source;
                    }
                });

                let newsData = [];

                if (activeSource === 'newsapi') {
                    // أخبار عالمية
                    const newsUrl = `https://newsdata.io/api/1/news?apikey=${NEWS_API_KEY}&q=weather&language=ar`;
                    const response = await fetch(newsUrl);
                    const data = await response.json();

                    if (data.results) {
                        newsData = data.results.slice(0, 5).map(item => ({
                            title: item.title,
                            description: item.description || 'لا يوجد وصف',
                            time: new Date(item.pubDate).toLocaleTimeString('ar-DZ'),
                            source: 'أخبار عالمية'
                        }));
                    }
                } else if (activeSource === 'local') {
                    // أخبار محلية (محاكاة)
                    newsData = [
                        {
                            title: 'تحذير من موجة حر في الجنوب الجزائري',
                            description: 'تتوقع مصالح الأرصاد الجوية موجة حر شديدة في ولايات الجنوب الأسبوع المقبل.',
                            time: '10:30',
                            source: 'الأرصاد الجزائرية'
                        },
                        {
                            title: 'تحسن في الأحوال الجوية بالشمال',
                            description: 'من المتوقع تحسن الأحوال الجوية بداية من يوم الغد مع انخفاض في درجات الحرارة.',
                            time: '09:15',
                            source: 'التلفزيون الجزائري'
                        }
                    ];
                } else if (activeSource === 'alerts') {
                    // تنبيهات (محاكاة)
                    newsData = [
                        {
                            title: 'تحذير أحمر: رياح قوية على السواحل',
                            description: 'تحذير من رياح قوية قد تصل سرعتها إلى 80 كم/س على السواحل الجزائرية.',
                            time: '08:00',
                            source: 'الحماية المدنية'
                        },
                        {
                            title: 'تنبيه: أمطار غزيرة متوقعة',
                            description: 'توقعات بهطول أمطار غزيرة في المناطق الشمالية خلال الـ24 ساعة القادمة.',
                            time: '07:45',
                            source: 'وزارة الداخلية'
                        }
                    ];
                }

                // تحديث شبكة الأخبار
                updateNewsGrid(newsData);

                hideAlert();

            } catch (error) {
                console.error('Error fetching news:', error);
                // استخدام بيانات وهمية في حالة الخطأ
                const fallbackNews = [
                    {
                        title: 'الأحوال الجوية مستقرة على معظم التراب الوطني',
                        description: 'توقعات بطقس مستقر خلال الأيام القليلة القادمة.',
                        time: new Date().toLocaleTimeString('ar-DZ'),
                        source: 'موقع الطقس الجزائري'
                    }
                ];

                updateNewsTicker(fallbackNews);
                updateNewsGrid(fallbackNews);
            }
        }

        // تحديث شريط الأخبار
        function updateNewsTicker(newsData) {
            newsTicker.innerHTML = newsData.map(item => `
            <div class="news-item">
                <h4>${item.title}</h4>
                <p>${item.description}</p>
                <div class="news-time">${item.time} | ${item.source}</div>
            </div>
        `).join('');
        }

        // تحديث شبكة الأخبار
        function updateNewsGrid(newsData) {
            const newsImages = [
                'https://images.unsplash.com/photo-1592210454359-9043f067919b?q=80&w=1000',
                'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?q=80&w=1000',
                'https://images.unsplash.com/photo-1534088568595-a066f410bcda?q=80&w=1000',
                'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?q=80&w=1000'
            ];

            newsGrid.innerHTML = newsData.map((item, index) => `
            <div class="news-card">
                <div class="news-image">
                    <img src="${newsImages[index % newsImages.length]}" alt="${item.title}">
                </div>
                <div class="news-content">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                    <div class="news-meta">
                        <span>${item.source}</span>
                        <span>${item.time}</span>
                    </div>
                </div>
            </div>
        `).join('');
        }

        // تحميل معرض الصور

        function loadGalleryDynamic(weatherId) {
            const category = getWeatherCategory(weatherId);
            const images = dynamicWeatherImages[category] || dynamicWeatherImages.clear;

            galleryGrid.innerHTML = images.map(image => `
        <div class="gallery-item fade-in">
            <img src="${image.url}" alt="${image.title}">
            <div class="gallery-overlay">
                <h4>${image.title}</h4>
            </div>
        </div>
    `).join('');
        }
        // صور ديناميكية حسب حالة الطقس
        const dynamicWeatherImages = {
            clear: [
                { url: "https://images.unsplash.com/photo-1592210454359-9043f067919b?q=80&w=1000", title: "سماء صافية" },
                { url: "https://images.unsplash.com/photo-1501973801540-537f08ccae7b?q=80&w=1000", title: "شمس مشرقة" }
            ],
            clouds: [
                { url: "https://images.unsplash.com/photo-1505583712945-c73f92e242fd?q=80&w=1000", title: "غيوم كثيفة" },
                { url: "https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?q=80&w=1000", title: "سماء غائمة" }
            ],
            rain: [
                { url: "https://images.unsplash.com/photo-1526674183561-4f3fbf0f5d1f?q=80&w=1000", title: "أمطار غزيرة" },
                { url: "https://images.unsplash.com/photo-1501594907352-04cda38ebc29?q=80&w=1000", title: "طقس ممطر" }
            ],
            thunder: [
                { url: "https://images.unsplash.com/photo-1500673922987-e212871fec22?q=80&w=1000", title: "عاصفة رعدية" },
                { url: "https://images.unsplash.com/photo-1496450681664-3df85efbd29f?q=80&w=1000", title: "برق في السماء" }
            ],
            snow: [
                { url: "https://images.unsplash.com/photo-1480796927426-f609979314bd?q=80&w=1000", title: "ثلوج" },
                { url: "https://images.unsplash.com/photo-1608889175121-cc4154786e7b?q=80&w=1000", title: "طقس ثلجي" }
            ],
            fog: [
                { url: "https://images.unsplash.com/photo-1543968996-ee822b8176ba?q=80&w=1000", title: "ضباب كثيف" },
                { url: "https://images.unsplash.com/photo-1500375592092-40eb2168fd21?q=80&w=1000", title: "صباح ضبابي" }
            ]
        };

        function getWeatherCategory(weatherId) {
            if (weatherId >= 200 && weatherId < 300) return "thunder";
            if (weatherId >= 300 && weatherId < 600) return "rain";
            if (weatherId >= 600 && weatherId < 700) return "snow";
            if (weatherId >= 700 && weatherId < 800) return "fog";
            if (weatherId === 800) return "clear";
            if (weatherId > 800) return "clouds";
            return "clear";
        }

        // معالجة البحث عن المدن
        function handleSearchInput(e) {
            const query = e.target.value.trim();
            if (query.length >= 2) {
                searchCities(query);
            } else {
                citySuggestions.classList.add('hidden');
            }
        }

        //الة البحث الديناميكي عبر Nominatim
        async function dynamicSearchCities(query) {
            const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=8&q=${encodeURIComponent(query)}`;

            const response = await fetch(url, {
                headers: {
                    'User-Agent': 'meteo-dz/1.0'
                }
            });

            const data = await response.json();

            return data.map(place => ({
                name: place.display_name,
                lat: place.lat,
                lon: place.lon,
                city: place.address.city || place.address.town || place.address.village || "",
                admin: place.address.state || "",
                country: place.address.country || ""
            }));
        }

        // وظيفة عرض الاقتراحات
        function renderSuggestions(list) {
            if (!list || list.length === 0) {
                citySuggestions.classList.add('hidden');
                return;
            }

            citySuggestions.innerHTML = list.map(city => `
        <div class="city-suggestion-item"
            data-lat="${city.lat}"
            data-lon="${city.lon}"
            data-name="${city.name}">
            ${city.name}
        </div>
    `).join('');

            citySuggestions.classList.remove('hidden');
        }

        //وظيفة عرض الاقتراحات2
        async function handleSearchInput(e) {
            const query = e.target.value.trim();

            if (query.length < 2) {
                citySuggestions.classList.add('hidden');
                return;
            }

            const results = await dynamicSearchCities(query);

            renderDynamicSuggestions(results);
        }

        //عرض الاقتراحات بصيغة Google Maps
        function renderDynamicSuggestions(list) {
            if (!list || list.length === 0) {
                citySuggestions.classList.add('hidden');
                return;
            }

            citySuggestions.innerHTML = list.map(place => `
        <div class="city-suggestion-item"
            data-lat="${place.lat}"
            data-lon="${place.lon}"
            data-name="${place.city || place.name}">
            
            <div style="font-weight:600;">
                ${place.city || place.name}
            </div>

            <div style="font-size:13px; color:#6b7280;">
                ${place.admin} – ${place.country}
            </div>
        </div>
    `).join('');

            citySuggestions.classList.remove('hidden');

            document.querySelectorAll('.city-suggestion-item').forEach(item => {
                item.addEventListener('click', function () {
                    const lat = parseFloat(this.dataset.lat);
                    const lon = parseFloat(this.dataset.lon);
                    const cityName = this.dataset.name;

                    searchInput.value = cityName;
                    citySuggestions.classList.add('hidden');

                    updateWeatherForCity({ name: cityName, lat, lon });

                    if (weatherMap) {
                        weatherMap.setView([lat, lon], 9);
                        addWeatherMarker(lat, lon, cityName);
                    }
                });
            });
        }

        // البحث الجغرافي الخارجي (OpenWeather)
        async function fetchGeoCities(query) {
            try {
                const url = `https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(query)}&limit=5&appid=${OPENWEATHER_API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();

                return data.map(c => ({
                    name: c.local_names?.ar || c.name,
                    lat: c.lat,
                    lon: c.lon
                }));
            } catch (e) {
                console.error("Geo Search Error:", e);
                return [];
            }
        }

        // البحث الموحد (محلي + خارجي)
        async function unifiedSearch(query) {
            // محاولة البحث المحلي أولاً
            const local = algerianCities.filter(c =>
                c.name.toLowerCase().includes(query.toLowerCase())
            );

            if (local.length > 0) {
                renderSuggestions(local);
                return;
            }

            // إن لم توجد نتائج: استعمال API
            const external = await fetchGeoCities(query);
            renderSuggestions(external);
        }

        // Debounce لمنع spam على API
        function debounce(fn, delay = 350) {
            let timer;
            return function (...args) {
                clearTimeout(timer);
                timer = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        // مستمع الكتابة في مربع البحث
        searchInput.addEventListener('input', debounce((e) => {
            const q = e.target.value.trim();
            if (q.length < 2) {
                citySuggestions.classList.add('hidden');
                return;
            }
            unifiedSearch(q);
        }, 300));

        // Event Delegation للتعامل مع النقر على أي اقتراح دون listeners متكررين
        citySuggestions.addEventListener('click', (e) => {
            const item = e.target.closest(".city-suggestion-item");
            if (!item) return;

            const lat = parseFloat(item.dataset.lat);
            const lon = parseFloat(item.dataset.lon);
            const name = item.dataset.name;

            searchInput.value = name;
            citySuggestions.classList.add('hidden');

            updateWeatherForCity({ name, lat, lon });

            if (weatherMap) {
                weatherMap.setView([lat, lon], 10);
                addWeatherMarker(lat, lon, name);
            }
        });


        // تحديث الطقس لمدينة محددة
        async function updateWeatherForCity(city) {
            currentLocation = { lat: city.lat, lon: city.lon };
            currentCity = city.name;
            await fetchWeatherData();
        }

        // الحصول على الموقع الجغرافي الحالي
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showAlert('المتصفح لا يدعم تحديد الموقع الجغرافي', 'error');
                return;
            }

            showLoading(locationBtn);

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    currentLocation = { lat, lon };

                    try {
                        // الحصول على اسم المدينة من الإحداثيات
                        const reverseGeocodeUrl = `https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${OPENWEATHER_API_KEY}`;
                        const response = await fetch(reverseGeocodeUrl);
                        const data = await response.json();

                        if (data && data.length > 0) {
                            currentCity = data[0].name || 'موقعك الحالي';
                            searchInput.value = currentCity;
                        }

                        await fetchWeatherData();

                        // تحديث الخريطة
                        if (weatherMap) {
                            weatherMap.setView([lat, lon], 10);
                            addWeatherMarker(lat, lon, 'موقعك الحالي');
                        }

                        showSuccess(locationBtn);

                    } catch (error) {
                        console.error('Error getting location name:', error);
                        currentCity = 'موقعك الحالي';
                        await fetchWeatherData();
                        showSuccess(locationBtn);
                    }
                },
                (error) => {
                    console.error('Error getting location:', error);
                    let errorMessage = 'تعذر تحديد موقعك الجغرافي';

                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'تم رفض إذن الوصول إلى الموقع';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'معلومات الموقع غير متاحة';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'انتهت مهلة طلب الموقع';
                            break;
                    }

                    showAlert(errorMessage, 'error');
                    showError(locationBtn);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // تهيئة الخريطة
        // ===============
        // 1) Initialize Map
        // ===============
        function initMap() {
            weatherMap = L.map('weatherMap').setView([currentLocation.lat, currentLocation.lon], 6);

            // Base map
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(weatherMap);

            // أول Marker فقط
            addWeatherMarker(currentLocation.lat, currentLocation.lon, 'الجزائر العاصمة');

            // Click to get weather
            weatherMap.on('click', handleMapClick);
        }


        // ===============
        // 2) Handle Map Click
        // ===============
        async function handleMapClick(e) {
            const lat = e.latlng.lat;
            const lon = e.latlng.lng;

            try {
                const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OPENWEATHER_API_KEY}&lang=ar`;
                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    L.popup()
                        .setLatLng([lat, lon])
                        .setContent(`
                    <div style="direction: rtl; text-align: right;">
                        <h3>${data.name}</h3>
                        <p><strong>درجة الحرارة:</strong> ${Math.round(data.main.temp)}°C</p>
                        <p><strong>الحالة:</strong> ${data.weather[0].description}</p>
                        <p><strong>الرطوبة:</strong> ${data.main.humidity}%</p>
                        <p><strong>الرياح:</strong> ${Math.round(data.wind.speed * 3.6)} كم/س</p>

                        <button onclick="updateWeatherForLocation(${lat}, ${lon}, '${data.name}')"
                            style="background: var(--algeria-green); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            عرض التفاصيل
                        </button>
                    </div>
                `)
                        .openOn(weatherMap);
                }
            } catch (error) {
                console.error('Error fetching weather for clicked location:', error);
            }
        }


        // ===============
        // 3) Add Marker (بدون إزالة كل العلامات)
        // ===============
        function addWeatherMarker(lat, lon, title) {
            const marker = L.marker([lat, lon]).addTo(weatherMap);
            marker.bindPopup(`<b>${title}</b><br>انقر على الخريطة للحصول على معلومات الطقس`);
        }


        // ===============
        // 4) Map Layer Switching (النسخة الذهبية)
        // ===============
        const tileLayers = {};

        function updateMapLayer() {
            const urls = {
                temperature: `https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${OPENWEATHER_API_KEY}`,
                precipitation: `https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${OPENWEATHER_API_KEY}`,
                wind: `https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${OPENWEATHER_API_KEY}`,
                clouds: `https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${OPENWEATHER_API_KEY}`
            };

            const key = currentLayer;

            // إنشاء الطبقة لو غير موجودة
            if (!tileLayers[key]) {
                tileLayers[key] = L.tileLayer(urls[key], {
                    opacity: 0.6,
                    maxZoom: 18,
                    attribution: '© OpenWeatherMap'
                });
            }

            // إزالة الطبقات الأخرى
            Object.keys(tileLayers).forEach(k => {
                if (weatherMap.hasLayer(tileLayers[k])) {
                    weatherMap.removeLayer(tileLayers[k]);
                }
            });

            // إضافة الطبقة المطلوبة
            tileLayers[key].addTo(weatherMap);
        }


        // بعد تضمين leaflet.markercluster.js و CSS
        const markers = L.markerClusterGroup({ chunkedLoading: true, chunkProgress: updateProgress });
        const geoData = []; // مصفوفة نقاطك
        geoData.forEach(pt => {
            markers.addLayer(L.marker([pt.lat, pt.lon]));
        });
        map.addLayer(markers);

        // وظائف مساعدة للطقس
        function getWeatherIcon(weatherId, hour) {
            const isDay = hour >= 6 && hour < 18;

            if (weatherId >= 200 && weatherId < 300) {
                return 'fas fa-bolt';
            } else if (weatherId >= 300 && weatherId < 500) {
                return 'fas fa-cloud-rain';
            } else if (weatherId >= 500 && weatherId < 600) {
                return 'fas fa-cloud-showers-heavy';
            } else if (weatherId >= 600 && weatherId < 700) {
                return 'fas fa-snowflake';
            } else if (weatherId >= 700 && weatherId < 800) {
                return 'fas fa-smog';
            } else if (weatherId === 800) {
                return isDay ? 'fas fa-sun' : 'fas fa-moon';
            } else if (weatherId > 800) {
                return 'fas fa-cloud';
            }

            return 'fas fa-cloud';
        }

        function getMostCommon(arr) {
            return arr.sort((a, b) =>
                arr.filter(v => v === a).length - arr.filter(v => v === b).length
            ).pop();
        }

        // وظائف مساعدة للواجهة
        function showAlert(message, type = 'info') {
            alertText.textContent = message;
            alertBanner.style.display = 'flex';

            if (type === 'error') {
                alertBanner.style.backgroundColor = 'var(--algeria-red)';
            } else if (type === 'warning') {
                alertBanner.style.backgroundColor = 'var(--warning-orange)';
            } else {
                alertBanner.style.backgroundColor = 'var(--algeria-green)';
            }
        }

        function hideAlert() {
            alertBanner.style.display = 'none';
        }

        function showLoading(element) {
            element.classList.add('loading');
            element.disabled = true;
        }

        function hideLoading(element) {
            element.classList.remove('loading');
            element.disabled = false;
        }

        function showSuccess(element) {
            element.classList.add('success');
            setTimeout(() => {
                element.classList.remove('success');
            }, 2000);
        }

        function showError(element) {
            element.classList.add('error');
            setTimeout(() => {
                element.classList.remove('error');
            }, 2000);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = themeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            }
        }

        // اختبار اتصال API
        async function testAPIConnection() {
            try {
                // اختبار اتصال OpenWeatherMap
                const testUrl = `https://api.openweathermap.org/data/2.5/weather?lat=36.752887&lon=3.042048&appid=${OPENWEATHER_API_KEY}`;
                const response = await fetch(testUrl);

                if (response.ok) {
                    apiStatus.innerHTML = '<i class="fas fa-check-circle"></i> API Connected';
                    apiStatus.classList.remove('error');
                } else {
                    throw new Error('OpenWeatherMap API failed');
                }
            } catch (error) {
                console.error('API Connection Error:', error);
                apiStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> API Error';
                apiStatus.classList.add('error');
            }
        }

        // دالة عامة لاستخدامها في النوافذ المنبثقة
        window.updateWeatherForLocation = async function (lat, lon, cityName) {
            searchInput.value = cityName;
            await updateWeatherForCity({ name: cityName, lat, lon });
            weatherMap.closePopup();
        };

        // تحميل الثيم المحفوظ
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            const icon = themeToggle.querySelector('i');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }


        // تحسين اختيار المدن بالـ GPS (Smart Geolocation)
        function smartLocateUser() {
            if (!navigator.geolocation) {
                alert("المتصفح لا يدعم GPS");
                return;
            }

            navigator.geolocation.getCurrentPosition(async (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;

                // تحديث الخريطة
                weatherMap.setView([lat, lon], 12);
                addWeatherMarker(lat, lon, "موقعي الحالي");

                // جلب اسم المنطقة عبر Reverse Geocoding
                const url = `https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${OPENWEATHER_API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();

                let cityName =
                    data[0]?.local_names?.ar ||
                    data[0]?.name ||
                    "موقع غير معروف";

                searchInput.value = cityName;

                updateWeatherForCity({ name: cityName, lat, lon });

            }, (err) => {
                alert("تعذّر تحديد الموقع. يرجى تفعيل GPS.");
                console.error(err);
            }, {
                enableHighAccuracy: true,
                timeout: 7000
            });
        }

        // تحديث المفتاح حسب الطبقة الحالية  
        function updateMapLegend() {
            const legend = document.getElementById('mapLegend');
            let html = '';

            switch (currentLayer) {
                case 'temperature':
                    html = `<h4>درجة الحرارة (°C)</h4>
                    <div class="gradient-bar" style="background: linear-gradient(to right, #0000FF, #00BFFF, #00FF7F, #FFD700, #FF4500);"></div>
                    <div class="legend-labels">
                        <span>≤0°</span>
                        <span>10°</span>
                        <span>20°</span>
                        <span>30°</span>
                        <span>>30°</span>
                    </div>`;
                    break;
                case 'precipitation':
                    html = `<h4>هطول الأمطار (مم)</h4>
                    <div class="gradient-bar" style="background: linear-gradient(to right, #FFFFFF, #ADD8E6, #1E90FF, #0000FF);"></div>
                    <div class="legend-labels">
                        <span>0</span>
                        <span>5</span>
                        <span>20</span>
                        <span>≥20</span>
                    </div>`;
                    break;
                case 'wind':
                    html = `<h4>سرعة الرياح (كم/س)</h4>
                    <div class="gradient-bar" style="background: linear-gradient(to right, #00FF00, #FFFF00, #FFA500, #FF0000);"></div>
                    <div class="legend-labels">
                        <span>0-10</span>
                        <span>20</span>
                        <span>40</span>
                        <span>≥50</span>
                    </div>`;
                    break;
                case 'clouds':
                    html = `<h4>الغطاء السحابي (%)</h4>
                    <div class="gradient-bar" style="background: linear-gradient(to right, #FFFFFF, #CCCCCC, #888888, #555555);"></div>
                    <div class="legend-labels">
                        <span>0%</span>
                        <span>25%</span>
                        <span>50%</span>
                        <span>75%</span>
                        <span>100%</span>
                    </div>`;
                    break;
            }

            legend.innerHTML = html;
        }

        // تحديث المفتاح عند تغيير الطبقة
        document.querySelectorAll('.map-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentLayer = this.dataset.layer;
                updateMapLayer();
                updateMapLegend();
            });
        });

        // تفعيل المفتاح عند تحميل الصفحة
        updateMapLegend();

        // زر الصعود للأعلى
        function setupScrollToTopButton() {
            const toTopBtn = document.getElementById('toTopBtn');

            // الاستماع لحدث scroll على window
            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) {
                    toTopBtn.classList.add('show');
                } else {
                    toTopBtn.classList.remove('show');
                }
            });

            // حدث النقر على الزر
            toTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // استدعاء الدالة في initApp
        async function initApp() {
            showAlert('جارٍ تحميل بيانات الطقس...', 'info');

            // إضافة Event Listeners
            setupEventListeners();

            // تهيئة الخريطة
            initMap();

            // جلب بيانات الطقس الحالي
            await fetchWeatherData();

            // جلب الأخبار
            await fetchWeatherNews();

            // تحميل معرض الصور
            loadGallery();

            // اختبار اتصال API
            testAPIConnection();

            // إعداد زر الصعود للأعلى
            setupScrollToTopButton();

            hideAlert();
        }

        // تحديث نصائح الطقس ديناميكيًا
        function updateWeatherTips(data) {
            const tipsContainer = document.querySelector('.tips-container');
            const temp = data.main.temp; // درجة الحرارة
            const weatherId = data.weather[0].id; // حالة الطقس
            const windSpeed = data.wind.speed * 3.6; // سرعة الرياح بالكيلومتر/ساعة

            const tips = [];

            // حماية من الشمس
            if (weatherId === 800 || (weatherId > 800 && weatherId < 900) && temp > 25) {
                tips.push({
                    icon: 'fas fa-sun',
                    title: 'حماية من الشمس',
                    text: 'مؤشر الأشعة فوق البنفسجية مرتفع. استخدم واقي الشمس وارتدِ قبعة ونظارات شمسية.'
                });
            }

            // ترطيب الجسم
            if (temp > 28) {
                tips.push({
                    icon: 'fas fa-tint',
                    title: 'ترطيب الجسم',
                    text: 'اشرب الكثير من الماء لتجنب الجفاف، خصوصًا مع ارتفاع درجات الحرارة.'
                });
            }

            // البرد الشديد
            if (temp < 10) {
                tips.push({
                    icon: 'fas fa-snowflake',
                    title: 'الوقاية من البرد',
                    text: 'درجات الحرارة منخفضة. ارتدِ ملابس دافئة واحمِ يديك وقدميك.'
                });
            }

            // الأمطار
            if (weatherId >= 500 && weatherId < 600) {
                tips.push({
                    icon: 'fas fa-umbrella',
                    title: 'استعد للأمطار',
                    text: 'توقع هطول أمطار. احمل مظلتك وتجنب المناطق المنخفضة أثناء القيادة.'
                });
            }

            // الرياح القوية
            if (windSpeed > 50) {
                tips.push({
                    icon: 'fas fa-wind',
                    title: 'الرياح القوية',
                    text: 'سرعة الرياح عالية. ثبّت الأشياء في الخارج وتوخى الحذر أثناء الخروج.'
                });
            }

            // فصل الربيع (أبريل-يونيو)
            const month = new Date().getMonth() + 1;
            if (month >= 4 && month <= 6) {
                tips.push({
                    icon: 'fas fa-seedling',
                    title: 'فصل الربيع',
                    text: 'الأحوال الجوية قد تتغير بسرعة. ارتدِ ملابس قابلة للتعديل وحافظ على ترطيب بشرتك.'
                });
            }

            // موجات الحرارة
            if (temp > 35) {
                tips.push({
                    icon: 'fas fa-temperature-high',
                    title: 'موجات الحرارة',
                    text: 'تجنّب التعرض المباشر للشمس خلال فترة الظهيرة واشرب سوائل باردة بانتظام.'
                });
            }

            // توليد HTML
            tipsContainer.innerHTML = tips.map(tip => `
        <div class="tip-card">
            <div class="tip-icon">
                <i class="${tip.icon}"></i>
            </div>
            <h3 class="tip-title">${tip.title}</h3>
            <p>${tip.text}</p>
        </div>
    `).join('');
        }

    </script>

    <script>
        let lastScroll = 0;
        const header = document.querySelector("header");

        window.addEventListener("scroll", () => {
            const currentScroll = window.pageYOffset;

            if (currentScroll > lastScroll && currentScroll > 100) {
                // التمرير للأسفل → اخفاء الهيدر
                header.classList.add("hidden-header");
            } else {
                // التمرير للأعلى → اظهار الهيدر
                header.classList.remove("hidden-header");
            }

            lastScroll = currentScroll;
        });

    </script>

</body>

</html>
