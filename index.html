<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ - ØªÙ†Ø¨Ø¤Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #3b82f6;
            --alert-red: #dc2626;
            --warning-orange: #f59e0b;
            --success-green: #10b981;
            --dark-bg: #0f172a;
            --light-bg: #f8fafc;
            --algeria-green: #006233;
            --algeria-red: #d21034;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--light-bg);
            color: #1e293b;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        .dark-mode {
            background-color: var(--dark-bg);
            color: #e2e8f0;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--algeria-green), var(--primary-blue));
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo .algeria-flag {
            display: inline-block;
            width: 30px;
            height: 20px;
            background: linear-gradient(to right, var(--algeria-green) 50%, white 50%);
            position: relative;
            margin-right: 10px;
        }

        .logo .algeria-flag::before {
            content: 'â˜…';
            position: absolute;
            color: var(--algeria-red);
            font-size: 10px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: opacity 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }

        nav a:hover,
        nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-container {
            position: relative;
        }

        .search-container input {
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: none;
            border-radius: 25px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            width: 250px;
            font-family: 'Cairo', sans-serif;
        }

        .search-container input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Alert Banner */
        .alert-banner {
            background-color: var(--algeria-red);
            color: white;
            padding: 0.8rem 2rem;
            text-align: center;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Main Content */
        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .hero-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 992px) {
            .hero-section {
                grid-template-columns: 1fr;
            }
        }

        /* Current Weather Card */
        .current-weather {
            background: linear-gradient(135deg, var(--algeria-green), var(--primary-blue));
            color: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0, 98, 51, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 300px;
        }

        .current-weather::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .location h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .last-update {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .current-temp {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .temp-main {
            text-align: center;
        }

        .temp-main .temp {
            font-size: 5rem;
            font-weight: 700;
            line-height: 1;
        }

        .temp-main .condition {
            font-size: 1.5rem;
            margin-top: 0.5rem;
        }

        .weather-icon {
            font-size: 6rem;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .weather-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .detail-item {
            text-align: center;
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .detail-item i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* News Ticker */
        .news-ticker {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }

        .dark-mode .news-ticker {
            background-color: #1e293b;
        }

        .ticker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .dark-mode .ticker-header {
            border-bottom-color: #334155;
        }

        .ticker-header h3 {
            font-size: 1.3rem;
            color: var(--algeria-green);
        }

        .live-badge {
            background-color: var(--algeria-red);
            color: white;
            padding: 0.2rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ticker-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .news-item {
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .dark-mode .news-item {
            border-bottom-color: #334155;
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-item h4 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }

        .dark-mode .news-item h4 {
            color: #e2e8f0;
        }

        .news-item p {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .news-time {
            font-size: 0.8rem;
            color: var(--algeria-green);
        }

        /* Forecast Section */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: var(--algeria-green);
            position: relative;
            padding-right: 1rem;
        }

        .section-header h2::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: -5px;
            width: 50px;
            height: 3px;
            background-color: var(--algeria-green);
        }

        .btn {
            background-color: var(--algeria-green);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: var(--primary-blue);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 1200px) {
            .forecast-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .forecast-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .forecast-container {
                grid-template-columns: 1fr;
            }
        }

        .forecast-card {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .dark-mode .forecast-card {
            background-color: #1e293b;
        }

        .forecast-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .forecast-day {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--algeria-green);
        }

        .forecast-date {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 1rem;
        }

        .forecast-icon {
            font-size: 3rem;
            margin: 1rem 0;
        }

        .forecast-temp {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .high-temp {
            color: var(--algeria-red);
            font-weight: 700;
        }

        .low-temp {
            color: var(--primary-blue);
            font-weight: 700;
        }

        /* Weather Map */
        .weather-map-container {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
        }

        .dark-mode .weather-map-container {
            background-color: #1e293b;
        }

        .map-wrapper {
            height: 500px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 1rem;
            border: 1px solid #e2e8f0;
        }

        .dark-mode .map-wrapper {
            border-color: #334155;
        }

        #weatherMap {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .map-btn {
            background-color: #e2e8f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .dark-mode .map-btn {
            background-color: #334155;
            color: #e2e8f0;
        }

        .map-btn.active {
            background-color: var(--algeria-green);
            color: white;
        }

        /* Gallery */
        .gallery-container {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
        }

        .dark-mode .gallery-container {
            background-color: #1e293b;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .gallery-item {
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            height: 200px;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: white;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        /* Weather Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 992px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background-color: #1e293b;
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--algeria-green);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #64748b;
            font-size: 1rem;
        }

        /* Weather Tips */
        .tips-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (max-width: 992px) {
            .tips-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .tips-container {
                grid-template-columns: 1fr;
            }
        }

        .tip-card {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .tip-card {
            background-color: #1e293b;
        }

        .tip-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--success-green);
        }

        .tip-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--algeria-green);
        }

        /* Footer */
        footer {
            background-color: var(--algeria-green);
            color: white;
            padding: 3rem 2rem 1.5rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (max-width: 992px) {
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: white;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column ul li a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .social-links a:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            .search-container input {
                width: 200px;
            }

            main {
                padding: 0 1rem;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Chart Container */
        .chart-container {
            background-color: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 3rem;
            height: 400px;
        }

        .dark-mode .chart-container {
            background-color: #1e293b;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            nav {
                width: 100%;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }

            nav.active {
                max-height: 300px;
            }

            nav ul {
                flex-direction: column;
                padding-top: 1rem;
            }
        }

        /* API Status */
        .api-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--algeria-green);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .api-status.error {
            background-color: var(--algeria-red);
        }

        /* City Suggestions */
        .city-suggestions {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }

        .dark-mode .city-suggestions {
            background-color: #1e293b;
            color: white;
        }

        .city-suggestion-item {
            padding: 0.7rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #e2e8f0;
        }

        .dark-mode .city-suggestion-item {
            border-bottom-color: #334155;
        }

        .city-suggestion-item:hover {
            background-color: #f1f5f9;
        }

        .dark-mode .city-suggestion-item:hover {
            background-color: #334155;
        }

        /* Hourly Forecast */
        .hourly-forecast {
            overflow-x: auto;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .hourly-container {
            display: flex;
            gap: 1rem;
            min-width: 100%;
        }

        .hourly-card {
            min-width: 120px;
            background-color: white;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .hourly-card {
            background-color: #1e293b;
        }

        .hourly-time {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--algeria-green);
        }

        /* News Grid */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .news-card {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }

        .dark-mode .news-card {
            background-color: #1e293b;
        }

        .news-card:hover {
            transform: translateY(-5px);
        }

        .news-image {
            height: 180px;
            overflow: hidden;
        }

        .news-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .news-card:hover .news-image img {
            transform: scale(1.05);
        }

        .news-content {
            padding: 1.5rem;
        }

        .news-content h3 {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: var(--algeria-green);
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #64748b;
        }

        /* Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ù‚Ø³Ù… CSS */

        .location-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .location-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .location-btn:active {
            transform: scale(0.95);
        }

        .location-btn.loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .location-btn.error {
            color: var(--algeria-red);
        }

        .location-btn.success {
            color: #4ade80;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ… Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .location-btn {
                font-size: 1.3rem;
                width: 36px;
                height: 36px;
            }
        }
    </style>

</head>

<body>
    <!-- API Status Indicator -->
    <div class="api-status" id="apiStatus">
        <i class="fas fa-check-circle"></i>
        <span>API Connected</span>
    </div>

    <!-- Alert Banner -->
    <div class="alert-banner" id="alertBanner">
        <span id="alertText">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ù„Ù„Ø¬Ø²Ø§Ø¦Ø±...</span>
        <button class="alert-close" id="closeAlert">&times;</button>
    </div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <div class="algeria-flag"></div>
                <i class="fas fa-cloud-sun"></i>
                <h1>Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</h1>
            </div>

            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>

            <nav id="mainNav">
                <ul>
                    <li><a href="#home" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="#forecast">Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª</a></li>
                    <li><a href="#maps">Ø§Ù„Ø®Ø±Ø§Ø¦Ø·</a></li>
                    <li><a href="#news">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</a></li>
                    <li><a href="#gallery">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</a></li>
                    <li><a href="#contact">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
                </ul>
            </nav>

<div class="header-controls">
    <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†Ø© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©...">
        <div class="city-suggestions hidden" id="citySuggestions"></div>
    </div>
    
    <!-- Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ -->
    <button class="location-btn" id="locationBtn" title="ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ">
        <i class="fas fa-location-crosshairs"></i>
    </button>
    
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>
</div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero-section" id="home">
            <div class="current-weather" id="currentWeather">
                <div class="weather-header">
                    <div class="location">
                        <h2 id="currentCity">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©ØŒ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</h2>
                        <div class="last-update">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="updateTime">--:--</span></div>
                    </div>
                    <div class="weather-actions">
                        <button class="btn" id="refreshWeather">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                </div>

                <div class="current-temp">
                    <div class="temp-main">
                        <div class="temp" id="currentTemp">--Â°</div>
                        <div class="condition" id="currentCondition">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    <div class="weather-icon" id="weatherIcon">
                        <i class="fas fa-sun"></i>
                    </div>
                </div>

                <div class="weather-details" id="weatherDetails">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>
            </div>

            <div class="news-ticker">
                <div class="ticker-header">
                    <h3>Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬ÙˆÙŠØ©</h3>
                    <span class="live-badge">Ù…Ø¨Ø§Ø´Ø±</span>
                </div>
                <div class="news-source-controls">

                    <button class="btn" onclick="loadFromSource('newsapi')">
                        <i class="fas fa-newspaper"></i> Ø£Ø®Ø¨Ø§Ø± Ø¹Ø§Ù„Ù…ÙŠØ©
                    </button>
                    <button class="btn" onclick="loadFromSource('local')">
                        <i class="fas fa-map-marker-alt"></i> Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©
                    </button>
                    <button class="btn" onclick="loadFromSource('alerts')">
                        <i class="fas fa-exclamation-triangle"></i> ØªØ­Ø°ÙŠØ±Ø§Øª
                    </button>
                </div>
                <div class="ticker-content" id="newsTicker">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>

            </div>
        </section>

        <!-- Hourly Forecast -->
        <section>
            <div class="section-header">
                <h2>ØªÙ†Ø¨Ø¤Ø§Øª 24 Ø³Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
            </div>

            <div class="hourly-forecast">
                <div class="hourly-container" id="hourlyForecast">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>
            </div>
        </section>

        <!-- 7-Day Forecast -->
        <section id="forecast">
            <div class="section-header">
                <h2>ØªÙ†Ø¨Ø¤Ø§Øª 7 Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
                <button class="btn" id="viewFullForecast">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
            </div>

            <div class="forecast-container" id="forecastContainer">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
            </div>
        </section>

        <!-- Weather Map -->
        <section id="maps">
            <div class="section-header">
                <h2>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h2>
                <div class="map-controls">
                    <button class="map-btn active" data-layer="temperature">ğŸŒ¡ï¸ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©</button>
                    <button class="map-btn" data-layer="precipitation">ğŸ’§ Ù‡Ø·ÙˆÙ„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±</button>
                    <button class="map-btn" data-layer="wind">ğŸ’¨ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</button>
                    <button class="map-btn" data-layer="clouds">â˜ï¸ Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</button>
                </div>
            </div>

            <div class="weather-map-container">
                <div class="map-wrapper">
                    <div id="weatherMap"></div>
                </div>
            </div>
        </section>

        <!-- Temperature Chart -->
        <section>
            <div class="section-header">
                <h2>Ù…Ø®Ø·Ø· Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹</h2>
            </div>

            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
        </section>

        <!-- Weather Statistics -->
        <section>
            <div class="section-header">
                <h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            </div>

            <div class="stats-grid" id="statsGrid">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
            </div>
        </section>

        <!-- News Section -->
        <section id="news">
            <div class="section-header">
                <h2>Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø·Ù‚Ø³ ÙˆØ§Ù„Ù…Ù†Ø§Ø®</h2>
                <button class="btn" id="refreshNews">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
            </div>

            <div class="news-grid" id="newsGrid">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
            </div>
        </section>

        <!-- Gallery -->
        <section id="gallery">
            <div class="section-header">
                <h2>Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬ÙˆÙŠØ©</h2>
                <button class="btn" id="uploadPhoto">Ø±ÙØ¹ ØµÙˆØ±Ø©</button>
            </div>

            <div class="gallery-container">
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>
            </div>
        </section>

        <!-- Weather Tips -->
        <section>
            <div class="section-header">
                <h2>Ù†ØµØ§Ø¦Ø­ Ø·Ù‚Ø³ÙŠØ©</h2>
            </div>

            <div class="tips-container">
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <h3 class="tip-title">Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù…Ø³</h3>
                    <p>Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø´Ø¹Ø© ÙÙˆÙ‚ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠØ© Ù…Ø±ØªÙØ¹ Ø§Ù„ÙŠÙˆÙ…. Ø§Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù‚ÙŠ Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ø±ØªØ¯ÙŠ Ù†Ø¸Ø§Ø±Ø§Øª Ø´Ù…Ø³ÙŠØ© ÙˆÙ‚Ø¨Ø¹Ø© Ù„Ù„Ø­Ù…Ø§ÙŠØ©.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <h3 class="tip-title">ØªØ±Ø·ÙŠØ¨ Ø§Ù„Ø¬Ø³Ù…</h3>
                    <p>Ø§Ø´Ø±Ø¨ 8-10 Ø£ÙƒÙˆØ§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø®Ø§ØµØ© Ù…Ø¹ Ø§Ø±ØªÙØ§Ø¹ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¬ÙØ§Ù.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-umbrella"></i>
                    </div>
                    <h3 class="tip-title">Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø£Ù…Ø·Ø§Ø±</h3>
                    <p>ØªÙˆÙ‚Ø¹Ø§Øª Ø¨Ù‡Ø·ÙˆÙ„ Ø£Ù…Ø·Ø§Ø± ØºØ¯Ø§Ù‹. Ø§Ø­Ù…Ù„ Ù…Ø¸Ù„ØªÙƒ ÙˆØªØ¬Ù†Ø¨ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="contact">
        <div class="footer-content">
            <div class="footer-column">
                <h3>Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</h3>
                <p>Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ù„ØªÙ†Ø¨Ø¤Ø§Øª Ø§Ù„Ø¬ÙˆÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø¬Ø²Ø§Ø¦Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… OpenWeatherMap API ÙˆØ®Ø±Ø§Ø¦Ø· Leaflet Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©.
                </p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>

            <div class="footer-column">
                <h3>Ù…Ø¯Ù† Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                <ul>
                    <li><a href="#" data-city="Algiers">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©</a></li>
                    <li><a href="#" data-city="Oran">ÙˆÙ‡Ø±Ø§Ù†</a></li>
                    <li><a href="#" data-city="Constantine">Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©</a></li>
                    <li><a href="#" data-city="Annaba">Ø¹Ù†Ø§Ø¨Ø©</a></li>
                    <li><a href="#" data-city="Blida">Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©</a></li>
                    <li><a href="#" data-city="Setif">Ø³Ø·ÙŠÙ</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3>Ø®Ø¯Ù…Ø§ØªÙ†Ø§</h3>
                <ul>
                    <li><a href="#forecast">ØªÙ†Ø¨Ø¤Ø§Øª Ø§Ù„Ø·Ù‚Ø³</a></li>
                    <li><a href="#maps">Ø®Ø±Ø§Ø¦Ø· ØªÙØ§Ø¹Ù„ÙŠØ©</a></li>
                    <li><a href="#news">Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø·Ù‚Ø³</a></li>
                    <li><a href="#gallery">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</a></li>
                    <li><a href="#">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø·Ù‚Ø³</a></li>
                    <li><a href="#">Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ®ÙŠØ©</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3>Ø§ØªØµÙ„ Ø¨Ù†Ø§</h3>
                <ul>
                    <li><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©</li>
                    <li><i class="fas fa-phone"></i> +213 21 123 4567</li>
                    <li><i class="fas fa-envelope"></i> info@algeria-weather.dz</li>
                    <li><i class="fas fa-clock"></i> 24/7 Ø¯Ø¹Ù… Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</li>
                </ul>
            </div>
        </div>

        <div class="copyright">
            <p>Â© 2024 Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            <p>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† <a href="https://openweathermap.org" style="color:#fff;">OpenWeatherMap</a> | Ø®Ø±Ø§Ø¦Ø·
                Ù…Ù† <a href="https://leafletjs.com" style="color:#fff;">Leaflet</a></p>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="app.js"></script>

    <script>
// ============================================
// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ - JavaScript Ø§Ù„ÙƒØ§Ù…Ù„
// ============================================

// API Key Ù„Ù€ OpenWeatherMap (ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø®Ø§Øµ)
const API_KEY = '1151122405b6f7be33bf0de4b22bb5a4';

// Ù…Ø¯Ù† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
const ALGERIAN_CITIES = [
    { name: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©", lat: 36.7525, lon: 3.04197, arName: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©" },
    { name: "Oran", lat: 35.6971, lon: -0.63373, arName: "ÙˆÙ‡Ø±Ø§Ù†" },
    { name: "Constantine", lat: 36.365, lon: 6.61472, arName: "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©" },
    { name: "Annaba", lat: 36.9, lon: 7.76667, arName: "Ø¹Ù†Ø§Ø¨Ø©" },
    { name: "Blida", lat: 36.4681, lon: 2.8287, arName: "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©" },
    { name: "Setif", lat: 36.1912, lon: 5.41373, arName: "Ø³Ø·ÙŠÙ" },
    { name: "Batna", lat: 35.556, lon: 6.1741, arName: "Ø¨Ø§ØªÙ†Ø©" },
    { name: "Djelfa", lat: 34.6728, lon: 3.263, arName: "Ø§Ù„Ø¬Ù„ÙØ©" },
    { name: "Tlemcen", lat: 34.8823, lon: -1.3167, arName: "ØªÙ„Ù…Ø³Ø§Ù†" },
    { name: "Biskra", lat: 34.8504, lon: 5.7281, arName: "Ø¨Ø³ÙƒØ±Ø©" },
    { name: "Tamanrasset", lat: 22.785, lon: 5.52278, arName: "ØªÙ…Ù†Ø±Ø§Ø³Øª" },
    { name: "Ghardaia", lat: 32.4897, lon: 3.67395, arName: "ØºØ±Ø¯Ø§ÙŠØ©" },
    { name: "Mostaganem", lat: 35.9342, lon: 0.09028, arName: "Ù…Ø³ØªØºØ§Ù†Ù…" },
    { name: "Bejaia", lat: 36.7559, lon: 5.0843, arName: "Ø¨Ø¬Ø§ÙŠØ©" },
    { name: "Tizi Ouzou", lat: 36.7167, lon: 4.05, arName: "ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ" }
];

// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
let currentCity = ALGERIAN_CITIES[0];
let currentWeatherData = null;
let weatherMap = null;
let temperatureChart = null;
let currentLayer = 'temperature';

// Ù…ØªØºÙŠØ±Ø§Øª DOM
const domElements = {
    apiStatus: document.getElementById('apiStatus'),
    alertBanner: document.getElementById('alertBanner'),
    alertText: document.getElementById('alertText'),
    closeAlert: document.getElementById('closeAlert'),
    mobileMenuBtn: document.getElementById('mobileMenuBtn'),
    mainNav: document.getElementById('mainNav'),
    searchInput: document.getElementById('searchInput'),
    citySuggestions: document.getElementById('citySuggestions'),
    themeToggle: document.getElementById('themeToggle'),
    currentCity: document.getElementById('currentCity'),
    updateTime: document.getElementById('updateTime'),
    refreshWeather: document.getElementById('refreshWeather'),
    currentTemp: document.getElementById('currentTemp'),
    currentCondition: document.getElementById('currentCondition'),
    weatherIcon: document.getElementById('weatherIcon'),
    weatherDetails: document.getElementById('weatherDetails'),
    newsTicker: document.getElementById('newsTicker'),
    hourlyForecast: document.getElementById('hourlyForecast'),
    forecastContainer: document.getElementById('forecastContainer'),
    viewFullForecast: document.getElementById('viewFullForecast'),
    weatherMap: document.getElementById('weatherMap'),
    temperatureChart: document.getElementById('temperatureChart'),
    statsGrid: document.getElementById('statsGrid'),
    newsGrid: document.getElementById('newsGrid'),
    refreshNews: document.getElementById('refreshNews'),
    galleryGrid: document.getElementById('galleryGrid'),
    uploadPhoto: document.getElementById('uploadPhoto'),
    locationBtn: document.getElementById('locationBtn')
};

// ============================================
// 1. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ùˆ Event Listeners
// ============================================

document.addEventListener('DOMContentLoaded', function() {
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    initApp();
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
    if (!domElements.locationBtn) {
        const locationBtn = document.createElement('button');
        locationBtn.className = 'location-btn';
        locationBtn.id = 'locationBtn';
        locationBtn.title = 'ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ';
        locationBtn.innerHTML = '<i class="fas fa-location-crosshairs"></i>';
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø¹Ù†ØµØ± Ø§Ù„Ø¨Ø­Ø«
        const searchContainer = document.querySelector('.search-container');
        if (searchContainer) {
            searchContainer.parentNode.insertBefore(locationBtn, searchContainer.nextSibling);
        }
        
        domElements.locationBtn = locationBtn;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Event Listeners
    setupEventListeners();
    
    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    fetchWeatherData(currentCity.lat, currentCity.lon, currentCity.arName);
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    loadWeatherNews();
    
    // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
    loadGallery();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    initWeatherMap();
});

function initApp() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø³Ù…Ø©
    if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
        domElements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
}

function setupEventListeners() {
    // Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©
    if (domElements.mobileMenuBtn) {
        domElements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    }
    
    // Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù…Ø© (ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„/Ø§Ù„Ù†Ù‡Ø§Ø±)
    if (domElements.themeToggle) {
        domElements.themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù‚Ø³
    if (domElements.refreshWeather) {
        domElements.refreshWeather.addEventListener('click', function() {
            fetchWeatherData(currentCity.lat, currentCity.lon, currentCity.arName);
            showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³...', 'info');
        });
    }
    
    // Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    if (domElements.refreshNews) {
        domElements.refreshNews.addEventListener('click', loadWeatherNews);
    }
    
    // Ø²Ø± Ø±ÙØ¹ ØµÙˆØ±Ø©
    if (domElements.uploadPhoto) {
        domElements.uploadPhoto.addEventListener('click', function() {
            alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±. Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹!');
        });
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    if (domElements.closeAlert) {
        domElements.closeAlert.addEventListener('click', function() {
            domElements.alertBanner.style.display = 'none';
        });
    }
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯Ù†
    if (domElements.searchInput) {
        domElements.searchInput.addEventListener('input', handleCitySearch);
        domElements.searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchCity(this.value);
            }
        });
    }
    
    // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
    if (domElements.citySuggestions) {
        domElements.citySuggestions.addEventListener('click', function(e) {
            if (e.target.classList.contains('city-suggestion-item')) {
                const cityName = e.target.dataset.city;
                const city = ALGERIAN_CITIES.find(c => c.arName === cityName || c.name === cityName);
                if (city) {
                    searchInput.value = '';
                    domElements.citySuggestions.classList.add('hidden');
                    fetchWeatherData(city.lat, city.lon, city.arName);
                }
            }
        });
    }
    
    // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ù„ÙÙˆØªØ±
    document.querySelectorAll('.footer-column a[data-city]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const cityName = this.dataset.city;
            const city = ALGERIAN_CITIES.find(c => c.name === cityName);
            if (city) {
                fetchWeatherData(city.lat, city.lon, city.arName);
                showAlert(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ù„Ù€ ${city.arName}`, 'info');
            }
        });
    });
    
    // Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
    if (domElements.locationBtn) {
        domElements.locationBtn.addEventListener('click', getUserLocation);
    }
    
    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    document.querySelectorAll('.map-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentLayer = this.dataset.layer;
            updateWeatherMapLayer();
        });
    });
    
    // Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
    if (domElements.viewFullForecast) {
        domElements.viewFullForecast.addEventListener('click', function() {
            alert('Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ù„ØªÙ†Ø¨Ø¤Ø§Øª. Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹!');
        });
    }
    
    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³Ù„Ø³ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    document.querySelectorAll('nav a').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
                document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
                this.classList.add('active');
                
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø³
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
                if (window.innerWidth <= 768) {
                    domElements.mainNav.classList.remove('active');
                }
            }
        });
    });
}

// ============================================
// 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯Ù†
// ============================================

function handleCitySearch() {
    const searchTerm = this.value.trim();
    
    if (searchTerm.length === 0) {
        domElements.citySuggestions.classList.add('hidden');
        return;
    }
    
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¯Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø«
    const suggestions = ALGERIAN_CITIES.filter(city => 
        city.arName.includes(searchTerm) || 
        city.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    displayCitySuggestions(suggestions);
}

function displayCitySuggestions(cities) {
    if (cities.length === 0) {
        domElements.citySuggestions.innerHTML = '<div class="city-suggestion-item">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
    } else {
        domElements.citySuggestions.innerHTML = cities.map(city => 
            `<div class="city-suggestion-item" data-city="${city.arName}">
                <strong>${city.arName}</strong>
            </div>`
        ).join('');
    }
    
    domElements.citySuggestions.classList.remove('hidden');
}

function searchCity(cityName) {
    if (!cityName.trim()) return;
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©
    let city = ALGERIAN_CITIES.find(c => 
        c.arName === cityName || 
        c.name.toLowerCase() === cityName.toLowerCase()
    );
    
    if (city) {
        fetchWeatherData(city.lat, city.lon, city.arName);
        showAlert(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ù„Ù€ ${city.arName}`, 'info');
    } else {
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… API Ù„Ù„Ø¨Ø­Ø«
        searchCityAPI(cityName);
    }
    
    domElements.citySuggestions.classList.add('hidden');
}

async function searchCityAPI(cityName) {
    try {
        showAlert(`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ${cityName}...`, 'info');
        
        const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(cityName)}&appid=${API_KEY}&units=metric&lang=ar`
        );
        
        if (!response.ok) {
            throw new Error('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
        }
        
        const data = await response.json();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        currentCity = {
            name: data.name,
            lat: data.coord.lat,
            lon: data.coord.lon,
            arName: data.name
        };
        
        // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³
        displayCurrentWeather(data);
        
        // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª
        fetchForecastData(data.coord.lat, data.coord.lon);
        
        showAlert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ù„Ù€ ${data.name}`, 'success');
        
    } catch (error) {
        showAlert(`Ø®Ø·Ø£: ${error.message}. Ø¬Ø±Ø¨ Ø§Ø³Ù… Ù…Ø¯ÙŠÙ†Ø© Ø¢Ø®Ø±.`, 'error');
        console.error('Search error:', error);
    }
}

// ============================================
// 3. ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³
// ============================================

// ============================================
// ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©
// ============================================

async function fetchWeatherData(lat, lon, cityName, useGeolocation = false) {
    try {
        showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³...', 'info');
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù† Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
        if (useGeolocation && domElements.locationBtn) {
            domElements.locationBtn.classList.add('loading');
            domElements.locationBtn.disabled = true;
        }
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const currentResponse = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ar`
        );
        
        if (!currentResponse.ok) {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³');
        }
        
        const currentData = await currentResponse.json();
        currentWeatherData = currentData;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        currentCity = {
            name: currentData.name,
            lat: currentData.coord.lat,
            lon: currentData.coord.lon,
            arName: cityName || currentData.name,
            country: currentData.sys.country || 'DZ'
        };
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        displayCurrentWeather(currentData);
        
        // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª
        await fetchForecastData(lat, lon);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© API
        updateApiStatus('connected');
        
        showAlert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
        if (useGeolocation && domElements.locationBtn) {
            domElements.locationBtn.classList.remove('loading');
            domElements.locationBtn.disabled = false;
            domElements.locationBtn.classList.add('success');
            setTimeout(() => {
                domElements.locationBtn.classList.remove('success');
            }, 2000);
        }
        
    } catch (error) {
        console.error('Error fetching weather data:', error);
        showAlert(`Ø®Ø·Ø£: ${error.message}`, 'error');
        updateApiStatus('error');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
        if (useGeolocation && domElements.locationBtn) {
            domElements.locationBtn.classList.remove('loading');
            domElements.locationBtn.disabled = false;
            domElements.locationBtn.classList.add('error');
            setTimeout(() => {
                domElements.locationBtn.classList.remove('error');
            }, 2000);
        }
        
        // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
        displaySampleData();
    }
}

// ============================================
// ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
// ============================================

async function getUserLocation() {
    if (!navigator.geolocation) {
        showAlert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ", "error");
        return;
    }
    
    showAlert("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ...", "info");
    
    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        });
        
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        
        // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Geocoding Ø¹ÙƒØ³ÙŠ)
        const locationName = await getLocationNameFromCoords(lat, lon);
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
        await fetchWeatherData(lat, lon, locationName, true);
        
    } catch (error) {
        console.error("Geolocation error:", error);
        
        let errorMessage = "ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        
        switch(error.code) {
            case error.PERMISSION_DENIED:
                errorMessage = "ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.";
                break;
            case error.POSITION_UNAVAILABLE:
                errorMessage = "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
                break;
            case error.TIMEOUT:
                errorMessage = "Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
                break;
        }
        
        showAlert(errorMessage, "error");
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
        if (domElements.locationBtn) {
            domElements.locationBtn.classList.remove('loading');
            domElements.locationBtn.disabled = false;
        }
    }
}

// ============================================
// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¥Ù„Ù‰ Ø§Ø³Ù… Ù…ÙˆÙ‚Ø¹ (Geocoding Ø¹ÙƒØ³ÙŠ)
// ============================================

async function getLocationNameFromCoords(lat, lon) {
    try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Nominatim (OpenStreetMap) - Ù…Ø¬Ø§Ù†ÙŠ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ API Key
        const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ar`
        );
        
        if (!response.ok) {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹');
        }
        
        const data = await response.json();
        
        if (data.address) {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ø³Ù… Ù„Ù„Ù…ÙˆÙ‚Ø¹
            return data.address.city || 
                   data.address.town || 
                   data.address.village || 
                   data.address.county || 
                   "Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ";
        }
        
        return "Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ";
        
    } catch (error) {
        console.error("Reverse geocoding error:", error);
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… OpenWeatherMap Geocoding
        try {
            const response = await fetch(
                `https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${API_KEY}`
            );
            
            if (response.ok) {
                const data = await response.json();
                if (data.length > 0) {
                    return data[0].name;
                }
            }
        } catch (err) {
            console.error("OpenWeatherMap geocoding error:", err);
        }
        
        return "Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ";
    }
}

// ============================================
// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© setupEventListeners Ù„Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
// ============================================

function setupEventListeners() {
    // ... (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ) ...
    
    // Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
    if (domElements.locationBtn) {
        domElements.locationBtn.addEventListener('click', getUserLocation);
    }
    
    // Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù‚Ø³ (Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ - ÙŠØ­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
    if (domElements.refreshWeather) {
        domElements.refreshWeather.addEventListener('click', function() {
            if (currentCity) {
                fetchWeatherData(currentCity.lat, currentCity.lon, currentCity.arName, false);
                showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³...', 'info');
            } else {
                showAlert('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯ÙŠÙ†Ø© Ø£ÙˆÙ„Ø§Ù‹.', 'warning');
            }
        });
    }
    
    // ... (Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯) ...
}

// ============================================
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ API
// ============================================

function handleAPIError(error, context = '') {
    console.error(`API Error in ${context}:`, error);
    
    let message = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
    
    if (error.message.includes('Failed to fetch')) {
        message = 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
    } else if (error.message.includes('401') || error.message.includes('Invalid API key')) {
        message = 'Ù…ÙØªØ§Ø­ API ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
    } else if (error.message.includes('404')) {
        message = 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©';
    } else if (error.message.includes('429')) {
        message = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹';
    }
    
    showAlert(`Ø®Ø·Ø£ ${context ? 'ÙÙŠ ' + context : ''}: ${message}`, 'error');
    
    // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙƒØ¨Ø¯ÙŠÙ„
    if (context.includes('weather')) {
        displaySampleData();
        displaySampleForecast();
    }
}

// ============================================
// ÙˆØ¸ÙŠÙØ© Ø¨Ø¯ÙŠÙ„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹
// ============================================

function manualLocationUpdate() {
    const cityName = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:");
    
    if (cityName && cityName.trim() !== '') {
        searchCity(cityName.trim());
    }
}

// ============================================
// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
// ============================================

function displayLocationInfo(position) {
    const locationInfo = document.createElement('div');
    locationInfo.className = 'location-info';
    locationInfo.innerHTML = `
        <div class="location-details">
            <i class="fas fa-map-marker-alt"></i>
            <span>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${position.coords.latitude.toFixed(4)}, ${position.coords.longitude.toFixed(4)}</span>
            <span>Ø§Ù„Ø¯Ù‚Ø©: Â±${Math.round(position.coords.accuracy)} Ù…ØªØ±</span>
        </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØ­Øª Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
    const locationDiv = document.querySelector('.location');
    if (locationDiv) {
        const existingInfo = locationDiv.querySelector('.location-info');
        if (existingInfo) {
            existingInfo.remove();
        }
        locationDiv.appendChild(locationInfo);
    }
}

// ============================================
// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© fetchWeatherData Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
// ============================================

async function fetchWeatherDataWithLocation(lat, lon, cityName, position = null) {
    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³
    await fetchWeatherData(lat, lon, cityName, true);
    
    // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
    if (position) {
        displayLocationInfo(position);
    }
}

// ============================================
// Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
// ============================================

function showLocationOptions() {
    const optionsHTML = `
        <div class="location-options">
            <h3>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
            <button class="btn" onclick="getUserLocation()">
                <i class="fas fa-location-crosshairs"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
            </button>
            <button class="btn" onclick="manualLocationUpdate()">
                <i class="fas fa-map-marker-alt"></i> Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
            </button>
            <select id="quickCities" class="btn" onchange="handleQuickCitySelect(this)">
                <option value="">Ø§Ø®ØªØ± Ù…Ø¯ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹Ø©</option>
                ${ALGERIAN_CITIES.map(city => 
                    `<option value="${city.name}">${city.arName}</option>`
                ).join('')}
            </select>
        </div>
    `;
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ø£Ùˆ Ù‚Ø³Ù… Ù…Ø®ØµØµ
    const optionsDiv = document.createElement('div');
    optionsDiv.className = 'location-options-modal';
    optionsDiv.innerHTML = optionsHTML;
    
    document.body.appendChild(optionsDiv);
    
    // Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    const style = document.createElement('style');
    style.textContent = `
        .location-options-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            min-width: 300px;
        }
        
        .dark-mode .location-options-modal {
            background: var(--dark-bg);
            color: white;
        }
        
        .location-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .location-options select {
            padding: 0.7rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Cairo', sans-serif;
        }
        
        .dark-mode .location-options select {
            background: #334155;
            color: white;
            border-color: #475569;
        }
    `;
    
    document.head.appendChild(style);
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    const closeBtn = document.createElement('button');
    closeBtn.className = 'close-modal';
    closeBtn.innerHTML = 'Ã—';
    closeBtn.style.cssText = `
        position: absolute;
        top: 10px;
        left: 10px;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
    `;
    
    closeBtn.onclick = function() {
        document.body.removeChild(optionsDiv);
        document.head.removeChild(style);
    };
    
    optionsDiv.appendChild(closeBtn);
}

function handleQuickCitySelect(select) {
    if (select.value) {
        const city = ALGERIAN_CITIES.find(c => c.name === select.value);
        if (city) {
            fetchWeatherData(city.lat, city.lon, city.arName, false);
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        const modal = document.querySelector('.location-options-modal');
        if (modal) {
            document.body.removeChild(modal);
            const style = document.querySelector('style');
            if (style) document.head.removeChild(style);
        }
    }
}

// ============================================
// Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
// ============================================

function addQuickSettingsButton() {
    const settingsBtn = document.createElement('button');
    settingsBtn.className = 'settings-btn';
    settingsBtn.id = 'quickSettingsBtn';
    settingsBtn.title = 'Ø®ÙŠØ§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©';
    settingsBtn.innerHTML = '<i class="fas fa-cog"></i>';
    
    settingsBtn.style.cssText = `
        background: none;
        border: none;
        color: white;
        font-size: 1.3rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: background-color 0.3s;
        margin-right: 0.5rem;
    `;
    
    settingsBtn.addEventListener('mouseenter', function() {
        this.style.backgroundColor = 'rgba(255,255,255,0.1)';
    });
    
    settingsBtn.addEventListener('mouseleave', function() {
        this.style.backgroundColor = 'transparent';
    });
    
    settingsBtn.addEventListener('click', showLocationOptions);
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
    const headerControls = document.querySelector('.header-controls');
    if (headerControls) {
        headerControls.insertBefore(settingsBtn, headerControls.firstChild);
    }
}

// ============================================
// ØªÙ‡ÙŠØ¦Ø© Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
// ============================================

document.addEventListener('DOMContentLoaded', function() {
    // ... (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ) ...
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
    addQuickSettingsButton();
    
    // ... (Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯) ...
});

// ============================================
// ØªØ­Ø³ÙŠÙ†Ø§Øª CSS Ù„Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
// ============================================

// Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø¥Ù„Ù‰ Ù‚Ø³Ù… CSS ÙÙŠ HTML
const additionalStyles = `
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
.location-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 1.3rem;
    cursor: pointer;
    padding: 0.6rem;
    border-radius: 50%;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    margin-left: 0.5rem;
}

.location-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.location-btn:active {
    transform: scale(0.95);
}

.location-btn.loading {
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.location-btn.error {
    background: rgba(220, 38, 38, 0.3);
    color: #fecaca;
}

.location-btn.success {
    background: rgba(16, 185, 129, 0.3);
    color: #a7f3d0;
}

.location-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
.location-info {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
    border-radius: 8px;
    margin-top: 0.5rem;
    font-size: 0.85rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.location-info i {
    margin-left: 0.3rem;
}

/* Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
.settings-btn {
    background: none;
    border: none;
    color: white;
    font-size: 1.3rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: background-color 0.3s;
    margin-right: 0.5rem;
}

.settings-btn:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
@media (max-width: 768px) {
    .location-btn {
        font-size: 1.1rem;
        width: 40px;
        height: 40px;
        padding: 0.5rem;
    }
    
    .header-controls {
        gap: 0.5rem;
    }
}

/* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
.geo-alert {
    position: fixed;
    bottom: 80px;
    left: 20px;
    background: var(--algeria-green);
    color: white;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 1001;
    max-width: 300px;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
`;

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
function addLocationStyles() {
    const styleSheet = document.createElement("style");
    styleSheet.textContent = additionalStyles;
    document.head.appendChild(styleSheet);
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.addEventListener('DOMContentLoaded', addLocationStyles);

// ============================================
// ØªØ­Ø¯ÙŠØ« Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù‚Ø³ Ù„ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©
// ============================================

// Ø§Ù„Ø¢Ù† Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ¹Ù…Ù„ Ø¨Ø·Ø±ÙŠÙ‚ØªÙŠÙ†:
// 1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø°Ù„Ùƒ Ø§Ù„Ù…ÙˆÙ‚Ø¹
// 2. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆÙ‚Ø¹Ù‡ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
// 3. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙŠØ§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯ÙŠÙ†Ø©

// Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„ÙŠ Ø³ÙŠØ¨Ù‚Ù‰ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
// Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø³ÙŠØ¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
// Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø³ÙŠØ¹Ø·ÙŠ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©

// ============================================
// ÙˆØ¸ÙŠÙØ© ØªØ´ØºÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©
// ============================================

function initializeGeolocationFeatures() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
    if (!navigator.geolocation) {
        showAlert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø§ØµÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¯ÙŠÙ†Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.", "warning");
        return;
    }
    
    // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø²ÙŠØ§Ø±Ø©
    if (localStorage.getItem('locationPermissionAsked') !== 'true') {
        setTimeout(() => {
            const permissionAlert = document.createElement('div');
            permissionAlert.className = 'geo-alert';
            permissionAlert.innerHTML = `
                <div style="margin-bottom: 0.5rem;">
                    <strong>Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØŸ</strong>
                </div>
                <div style="font-size: 0.9rem; margin-bottom: 1rem;">
                    Ø³ÙŠØ³Ù…Ø­ Ø°Ù„Ùƒ Ø¨Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ Ù„Ù…Ù†Ø·Ù‚ØªÙƒ Ø¨Ø¯Ù‚Ø© Ø£Ø¹Ù„Ù‰
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="allowLocationPermission()" style="flex:1; background: white; color: var(--algeria-green); border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">
                        Ù†Ø¹Ù…ØŒ ØªÙØ¹ÙŠÙ„
                    </button>
                    <button onclick="denyLocationPermission()" style="flex:1; background: transparent; color: white; border: 1px solid white; padding: 0.5rem; border-radius: 5px; cursor: pointer;">
                        Ù„Ø§Ø­Ù‚Ø§Ù‹
                    </button>
                </div>
            `;
            
            document.body.appendChild(permissionAlert);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                if (permissionAlert.parentNode) {
                    permissionAlert.remove();
                }
            }, 10000);
        }, 3000);
    }
}

function allowLocationPermission() {
    localStorage.setItem('locationPermissionAsked', 'true');
    
    const alert = document.querySelector('.geo-alert');
    if (alert) alert.remove();
    
    getUserLocation();
}

function denyLocationPermission() {
    localStorage.setItem('locationPermissionAsked', 'true');
    
    const alert = document.querySelector('.geo-alert');
    if (alert) alert.remove();
    
    showAlert("ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹", "info");
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', initializeGeolocationFeatures);

async function fetchForecastData(lat, lon) {
    try {
        // Ø¬Ù„Ø¨ ØªÙ†Ø¨Ø¤Ø§Øª 5 Ø£ÙŠØ§Ù… (ÙƒÙ„ 3 Ø³Ø§Ø¹Ø§Øª)
        const forecastResponse = await fetch(
            `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ar`
        );
        
        if (!forecastResponse.ok) {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª');
        }
        
        const forecastData = await forecastResponse.json();
        
        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª
        displayHourlyForecast(forecastData);
        displayDailyForecast(forecastData);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        displayWeatherStats(forecastData);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø·
        renderTemperatureChart(forecastData);
        
    } catch (error) {
        console.error('Error fetching forecast data:', error);
        // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        displaySampleForecast();
    }
}

function displayCurrentWeather(data) {
    // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
    domElements.currentCity.textContent = `${currentCity.arName}ØŒ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±`;
    
    // ØªØ­Ø¯ÙŠØ« Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©
    domElements.currentTemp.textContent = `${Math.round(data.main.temp)}Â°`;
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³
    domElements.currentCondition.textContent = data.weather[0].description;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
    const iconCode = data.weather[0].icon;
    const iconClass = getWeatherIconClass(iconCode);
    domElements.weatherIcon.innerHTML = `<i class="fas ${iconClass}"></i>`;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙØ§ØµÙŠÙ„
    const detailsHTML = `
        <div class="detail-item">
            <i class="fas fa-thermometer-half"></i>
            <div>${Math.round(data.main.feels_like)}Â°</div>
            <div>ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-tint"></i>
            <div>${data.main.humidity}%</div>
            <div>Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-wind"></i>
            <div>${Math.round(data.wind.speed)} ÙƒÙ…/Ø³</div>
            <div>Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-compress-arrows-alt"></i>
            <div>${data.main.pressure} Ù‡ÙƒØªÙˆØ¨Ø§Ø³ÙƒØ§Ù„</div>
            <div>Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ</div>
        </div>
    `;
    
    domElements.weatherDetails.innerHTML = detailsHTML;
    
    // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«
    const now = new Date();
    domElements.updateTime.textContent = now.toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    if (weatherMap) {
        weatherMap.setView([data.coord.lat, data.coord.lon], 8);
        updateWeatherMapLayer();
    }
}

function displayHourlyForecast(data) {
    const hourlyData = data.list.slice(0, 8); // Ø£ÙˆÙ„ 8 ÙØªØ±Ø§Øª (24 Ø³Ø§Ø¹Ø©)
    
    const hourlyHTML = hourlyData.map(item => {
        const time = new Date(item.dt * 1000);
        const hour = time.getHours();
        const temp = Math.round(item.main.temp);
        const iconClass = getWeatherIconClass(item.weather[0].icon);
        
        return `
            <div class="hourly-card">
                <div class="hourly-time">${hour}:00</div>
                <div class="forecast-icon">
                    <i class="fas ${iconClass}"></i>
                </div>
                <div class="temp">${temp}Â°</div>
                <div class="condition">${item.weather[0].description}</div>
            </div>
        `;
    }).join('');
    
    domElements.hourlyForecast.innerHTML = hourlyHTML;
}

function displayDailyForecast(data) {
    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…
    const dailyForecasts = {};
    
    data.list.forEach(item => {
        const date = new Date(item.dt * 1000);
        const dayKey = date.toLocaleDateString('ar-EG', { weekday: 'long' });
        
        if (!dailyForecasts[dayKey]) {
            dailyForecasts[dayKey] = {
                temps: [],
                conditions: [],
                icons: [],
                date: date
            };
        }
        
        dailyForecasts[dayKey].temps.push(item.main.temp);
        dailyForecasts[dayKey].conditions.push(item.weather[0].description);
        dailyForecasts[dayKey].icons.push(item.weather[0].icon);
    });
    
    // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆØ¹Ø±Ø¶ Ø£ÙˆÙ„ 7 Ø£ÙŠØ§Ù…
    const dailyArray = Object.entries(dailyForecasts).slice(0, 7);
    
    const forecastHTML = dailyArray.map(([day, data], index) => {
        const avgTemp = Math.round(data.temps.reduce((a, b) => a + b) / data.temps.length);
        const maxTemp = Math.round(Math.max(...data.temps));
        const minTemp = Math.round(Math.min(...data.temps));
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ù‹Ø§
        const mostCommonIcon = mode(data.icons);
        const iconClass = getWeatherIconClass(mostCommonIcon);
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
        const dateStr = data.date.toLocaleDateString('ar-EG', {
            month: 'short',
            day: 'numeric'
        });
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ØŒ Ø§Ø³ØªØ®Ø¯Ù… "Ø§Ù„ÙŠÙˆÙ…"
        const dayName = index === 0 ? 'Ø§Ù„ÙŠÙˆÙ…' : day;
        
        return `
            <div class="forecast-card">
                <div class="forecast-day">${dayName}</div>
                <div class="forecast-date">${dateStr}</div>
                <div class="forecast-icon">
                    <i class="fas ${iconClass}"></i>
                </div>
                <div class="condition">${data.conditions[0]}</div>
                <div class="forecast-temp">
                    <span class="high-temp">${maxTemp}Â°</span>
                    <span class="low-temp">${minTemp}Â°</span>
                </div>
            </div>
        `;
    }).join('');
    
    domElements.forecastContainer.innerHTML = forecastHTML;
}

// ============================================
// 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
// ============================================

function initWeatherMap() {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    weatherMap = L.map('weatherMap').setView([28.0339, 1.6596], 6);
    
    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 18,
    }).addTo(weatherMap);
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    addCityMarker();
    
    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø·Ù‚Ø³
    updateWeatherMapLayer();
}

function addCityMarker() {
    if (!weatherMap || !currentCity) return;
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    weatherMap.eachLayer(layer => {
        if (layer instanceof L.Marker) {
            weatherMap.removeLayer(layer);
        }
    });
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
    const marker = L.marker([currentCity.lat, currentCity.lon]).addTo(weatherMap);
    
    // Ø¥Ø¶Ø§ÙØ© popup
    if (currentWeatherData) {
        const popupContent = `
            <strong>${currentCity.arName}</strong><br>
            ${Math.round(currentWeatherData.main.temp)}Â° - ${currentWeatherData.weather[0].description}<br>
            Ø§Ù„Ø±Ø·ÙˆØ¨Ø©: ${currentWeatherData.main.humidity}%<br>
            Ø§Ù„Ø±ÙŠØ§Ø­: ${Math.round(currentWeatherData.wind.speed)} ÙƒÙ…/Ø³
        `;
        marker.bindPopup(popupContent);
    }
}

function updateWeatherMapLayer() {
    if (!weatherMap) return;
    
    // Ø¥Ø²Ø§Ù„Ø© Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    weatherMap.eachLayer(layer => {
        if (layer.options && layer.options.weatherLayer) {
            weatherMap.removeLayer(layer);
        }
    });
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    let layerUrl = '';
    
    switch (currentLayer) {
        case 'temperature':
            layerUrl = `https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${API_KEY}`;
            break;
        case 'precipitation':
            layerUrl = `https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${API_KEY}`;
            break;
        case 'wind':
            layerUrl = `https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${API_KEY}`;
            break;
        case 'clouds':
            layerUrl = `https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${API_KEY}`;
            break;
    }
    
    if (layerUrl) {
        const weatherLayer = L.tileLayer(layerUrl, {
            attribution: 'Â© OpenWeatherMap',
            maxZoom: 18,
            weatherLayer: true
        }).addTo(weatherMap);
    }
}

// ============================================
// 5. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
// ============================================

function renderTemperatureChart(forecastData) {
    const ctx = domElements.temperatureChart.getContext('2d');
    
    // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    const days = [];
    const temps = [];
    
    const dailyData = forecastData.list.filter((item, index) => index % 8 === 0);
    
    dailyData.slice(0, 7).forEach(item => {
        const date = new Date(item.dt * 1000);
        days.push(date.toLocaleDateString('ar-EG', { weekday: 'short' }));
        temps.push(Math.round(item.main.temp));
    });
    
    // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
    if (temperatureChart) {
        temperatureChart.destroy();
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯
    temperatureChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: days,
            datasets: [{
                label: 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°C)',
                data: temps,
                borderColor: '#006233',
                backgroundColor: 'rgba(0, 98, 51, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: 'rgba(0,0,0,0.1)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            family: "'Cairo', sans-serif",
                            size: 14
                        }
                    }
                }
            }
        }
    });
}

function displayWeatherStats(data) {
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ†Ø¨Ø¤
    const temps = data.list.map(item => item.main.temp);
    const humidities = data.list.map(item => item.main.humidity);
    const windSpeeds = data.list.map(item => item.wind.speed);
    
    const statsHTML = `
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-thermometer-three-quarters"></i>
            </div>
            <div class="stat-value">${Math.round(Math.max(...temps))}Â°</div>
            <div class="stat-label">Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø©</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-temperature-low"></i>
            </div>
            <div class="stat-value">${Math.round(Math.min(...temps))}Â°</div>
            <div class="stat-label">Ø£Ø¯Ù†Ù‰ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø©</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-tint"></i>
            </div>
            <div class="stat-value">${Math.round(humidities.reduce((a, b) => a + b) / humidities.length)}%</div>
            <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-wind"></i>
            </div>
            <div class="stat-value">${Math.round(windSpeeds.reduce((a, b) => a + b) / windSpeeds.length)} ÙƒÙ…/Ø³</div>
            <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</div>
        </div>
    `;
    
    domElements.statsGrid.innerHTML = statsHTML;
}

// ============================================
// 6. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬ÙˆÙŠØ©
// ============================================

async function loadWeatherNews() {
    try {
        showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬ÙˆÙŠØ©...', 'info');
        
        // Ø§Ø³ØªØ®Ø¯Ù… NewsAPI Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø·Ù‚Ø³ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±
        const apiKey = 'a54d2320b1364332afb6f2b8ff71c172'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù…ÙØªØ§Ø­ NewsAPI Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const query = encodeURIComponent('Ø·Ù‚Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± OR Ø£Ø±ØµØ§Ø¯ Ø¬ÙˆÙŠØ© OR Ù…Ù†Ø§Ø®');
        const url = `https://newsapi.org/v2/everything?q=${query}&language=ar&sortBy=publishedAt&pageSize=10&apiKey=${apiKey}`;
        
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±');
        }
        
        const data = await response.json();
        
        if (data.articles && data.articles.length > 0) {
            displayNewsArticles(data.articles);
            showAlert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬ÙˆÙŠØ©', 'success');
        } else {
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            displayFallbackNews();
        }
        
    } catch (error) {
        console.error('Error loading news:', error);
        showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù…Ù† Ù…ØµØ¯Ø± Ø¨Ø¯ÙŠÙ„...', 'warning');
        displayFallbackNews();
    }
}

function displayNewsArticles(articles) {
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ù…Ù†Ø§Ø³Ø¨
    const newsItems = articles.slice(0, 4).map(article => ({
        title: article.title || 'Ø®Ø¨Ø± Ø¬ÙˆÙŠ Ø¬Ø¯ÙŠØ¯',
        content: article.description ? 
                 article.description.substring(0, 150) + '...' : 
                 'ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
        time: formatTimeAgo(article.publishedAt),
        image: article.urlToImage || getRandomWeatherImage(),
        source: article.source.name || 'Ù…ØµØ¯Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
        url: article.url
    }));
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    const newsHTML = newsItems.map(item => `
        <div class="news-card" onclick="window.open('${item.url}', '_blank')" style="cursor: pointer;">
            <div class="news-image">
                <img src="${item.image}" alt="${item.title}" onerror="this.src='https://images.unsplash.com/photo-1592210454359-9043f067919b?w=400&h=250&fit=crop'">
            </div>
            <div class="news-content">
                <h3>${item.title}</h3>
                <p>${item.content}</p>
                <div class="news-meta">
                    <span class="news-time">${item.time}</span>
                    <span class="news-source">${item.source}</span>
                </div>
            </div>
        </div>
    `).join('');
    
    domElements.newsGrid.innerHTML = newsHTML;
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    const tickerHTML = newsItems.map(item => `
        <div class="news-item" onclick="window.open('${item.url}', '_blank')" style="cursor: pointer;">
            <h4>${item.title}</h4>
            <p>${item.content}</p>
            <div class="news-time">${item.time} | ${item.source}</div>
        </div>
    `).join('');
    
    domElements.newsTicker.innerHTML = tickerHTML;
}

function displayFallbackNews() {
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø®Ø¨Ø§Ø± Ø¨Ø¯ÙŠÙ„Ø© Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªÙ†ÙˆØ¹Ø©
    const fallbackNews = [
        {
            title: "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬ÙˆÙŠØ© Ù…Ù† Ù…ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø±ØµØ§Ø¯ Ø§Ù„Ø¬ÙˆÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©",
            content: "Ø£ØµØ¯Ø±Øª Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø£Ø±ØµØ§Ø¯ Ø§Ù„Ø¬ÙˆÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© ØªØ­Ø°ÙŠØ±Ø§Ù‹ Ù…Ù† Ø£Ù…Ø·Ø§Ø± ØºØ²ÙŠØ±Ø© ÙˆØ¹ÙˆØ§ØµÙ Ø±Ø¹Ø¯ÙŠØ© ÙÙŠ Ø¹Ø¯Ø© ÙˆÙ„Ø§ÙŠØ§Øª.",
            time: "Ù‚Ø¨Ù„ Ø³Ø§Ø¹Ø©",
            image: "https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?w=400&h=250&fit=crop",
            source: "Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„Ø£Ø±ØµØ§Ø¯ Ø§Ù„Ø¬ÙˆÙŠØ©",
            url: "https://www.meteo.dz"
        },
        {
            title: "Ø§Ù†Ø®ÙØ§Ø¶ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙÙŠ Ø´Ù…Ø§Ù„ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±",
            content: "ØªÙˆÙ‚Ø¹ Ø®Ø¨Ø±Ø§Ø¡ Ø§Ù„Ø£Ø±ØµØ§Ø¯ Ø§Ù†Ø®ÙØ§Ø¶Ø§Ù‹ ÙÙŠ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙŠØµÙ„ Ø¥Ù„Ù‰ 8 Ø¯Ø±Ø¬Ø§Øª Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† ÙŠÙˆÙ… Ø§Ù„ØºØ¯.",
            time: "Ù‚Ø¨Ù„ 3 Ø³Ø§Ø¹Ø§Øª",
            image: "https://images.unsplash.com/photo-1561484936-3f2f0107e6cc?w=400&h=250&fit=crop",
            source: "ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø£Ù†Ø¨Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©",
            url: "https://www.aps.dz"
        },
        {
            title: "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø® ÙÙŠ Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©",
            content: "Ø§Ø±ØªÙØ§Ø¹ ØºÙŠØ± Ù…Ø³Ø¨ÙˆÙ‚ ÙÙŠ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø¨Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¬Ù†ÙˆØ¨ Ø§Ù„ÙƒØ¨Ø±Ù‰ ÙŠØªØ¬Ø§ÙˆØ² 48 Ø¯Ø±Ø¬Ø© Ù…Ø¦ÙˆÙŠØ©.",
            time: "Ù‚Ø¨Ù„ 6 Ø³Ø§Ø¹Ø§Øª",
            image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop",
            source: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
            url: "https://www.mre.gov.dz"
        },
        {
            title: "ØªØ­Ø°ÙŠØ± Ù…Ù† Ø±ÙŠØ§Ø­ Ù‚ÙˆÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ§Ø­Ù„",
            content: "ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù† Ø±ÙŠØ§Ø­ Ù‚ÙˆÙŠØ© Ù‚Ø¯ ØªØµÙ„ Ø³Ø±Ø¹ØªÙ‡Ø§ Ø¥Ù„Ù‰ 80 ÙƒÙ…/Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø­Ù„ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.",
            time: "Ù‚Ø¨Ù„ ÙŠÙˆÙ…",
            image: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop",
            source: "Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©",
            url: "https://www.protectioncivile.gov.dz"
        }
    ];
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
    displayNewsArticles(fallbackNews);
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ "Ù…Ù†Ø° X"
function formatTimeAgo(publishedAt) {
    const now = new Date();
    const publishedDate = new Date(publishedAt);
    const diffInSeconds = Math.floor((now - publishedDate) / 1000);
    
    if (diffInSeconds < 60) {
        return 'Ø§Ù„Ø¢Ù†';
    } else if (diffInSeconds < 3600) {
        const minutes = Math.floor(diffInSeconds / 60);
        return `Ù‚Ø¨Ù„ ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
    } else if (diffInSeconds < 86400) {
        const hours = Math.floor(diffInSeconds / 3600);
        return `Ù‚Ø¨Ù„ ${hours} Ø³Ø§Ø¹Ø©`;
    } else {
        const days = Math.floor(diffInSeconds / 86400);
        return `Ù‚Ø¨Ù„ ${days} ÙŠÙˆÙ…`;
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø·Ù‚Ø³ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
function getRandomWeatherImage() {
    const weatherImages = [
        'https://images.unsplash.com/photo-1592210454359-9043f067919b?w=400&h=250&fit=crop',
        'https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?w=400&h=250&fit=crop',
        'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop',
        'https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop',
        'https://images.unsplash.com/photo-1551582045-6ec9c11d8697?w=400&h=250&fit=crop',
        'https://images.unsplash.com/photo-1561484936-3f2f0107e6cc?w=400&h=250&fit=crop'
    ];
    
    return weatherImages[Math.floor(Math.random() * weatherImages.length)];
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø·Ù‚Ø³ Ù…Ù† OpenWeatherMap (Ø¥Ø°Ø§ ÙƒØ§Ù† API Key ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙŠØ²Ø©)
async function loadWeatherAlerts() {
    try {
        // OpenWeatherMap API Ù„Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø¬ÙˆÙŠØ©
        const cityId = '2507480'; // Algiers city ID
        const url = `https://api.openweathermap.org/data/2.5/onecall?lat=36.7525&lon=3.04197&exclude=current,minutely,daily&appid=${API_KEY}&lang=ar`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.alerts && data.alerts.length > 0) {
            displayWeatherAlerts(data.alerts);
        }
    } catch (error) {
        console.log('No weather alerts available');
    }
}

function displayWeatherAlerts(alerts) {
    // Ø¥Ø¶Ø§ÙØ© ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø¥Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    alerts.forEach(alert => {
        const alertItem = document.createElement('div');
        alertItem.className = 'news-item';
        alertItem.innerHTML = `
            <h4 style="color: var(--algeria-red);">
                <i class="fas fa-exclamation-triangle"></i> ${alert.event}
            </h4>
            <p>${alert.description}</p>
            <div class="news-time">ØªØ­Ø°ÙŠØ± Ø±Ø³Ù…ÙŠ</div>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        domElements.newsTicker.insertBefore(alertItem, domElements.newsTicker.firstChild);
    });
}

// ============================================
// 7. ÙˆØ¸Ø§Ø¦Ù Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
// ============================================

function loadGallery() {
    // ØµÙˆØ± ØªØ¬Ø±ÙŠØ¨ÙŠØ© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ù€ API Ø­Ù‚ÙŠÙ‚ÙŠ)
    const galleryImages = [
        {
            url: "https://images.unsplash.com/photo-1592210454359-9043f067919b?w-600&h-400&fit-crop",
            title: "Ø³Ù…Ø§Ø¡ ØµØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¹Ø§ØµÙ…Ø©",
            location: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©"
        },
        {
            url: "https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?w=600&h=400&fit=crop",
            title: "Ø£Ù…Ø·Ø§Ø± ØºØ²ÙŠØ±Ø© ÙÙŠ ÙˆÙ‡Ø±Ø§Ù†",
            location: "ÙˆÙ‡Ø±Ø§Ù†"
        },
        {
            url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600&h=400&fit=crop",
            title: "ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³ ÙÙŠ Ø§Ù„ØµØ­Ø±Ø§Ø¡",
            location: "ØªÙ…Ù†Ø±Ø§Ø³Øª"
        },
        {
            url: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=600&h=400&fit=crop",
            title: "Ø³Ø­Ø¨ Ù…ØªÙ†Ø§Ø«Ø±Ø© ÙÙŠ Ø§Ù„Ù‚Ø¨Ø§Ø¦Ù„",
            location: "ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ"
        },
        {
            url: "https://images.unsplash.com/photo-1551582045-6ec9c11d8697?w=600&h=400&fit=crop",
            title: "Ø¶Ø¨Ø§Ø¨ ØµØ¨Ø§Ø­ÙŠ ÙÙŠ Ø§Ù„Ø£ÙˆØ±Ø§Ø³",
            location: "Ø¨Ø§ØªÙ†Ø©"
        },
        {
            url: "https://images.unsplash.com/photo-1601297183305-6df142704ea2?w=600&h=400&fit=crop",
            title: "Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø·Ø±",
            location: "Ø¹Ù†Ø§Ø¨Ø©"
        }
    ];
    
    const galleryHTML = galleryImages.map(image => `
        <div class="gallery-item">
            <img src="${image.url}" alt="${image.title}">
            <div class="gallery-overlay">
                <h4>${image.title}</h4>
                <p>${image.location}</p>
            </div>
        </div>
    `).join('');
    
    domElements.galleryGrid.innerHTML = galleryHTML;
}

// ============================================
// 8. ÙˆØ¸Ø§Ø¦Ù ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
// ============================================

function getUserLocation() {
    if (!navigator.geolocation) {
        showAlert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ", "error");
        return;
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    if (domElements.locationBtn) {
        domElements.locationBtn.classList.add('loading');
    }
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹ÙƒØ³ÙŠ
            fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${API_KEY}`)
                .then(response => response.json())
                .then(locationData => {
                    const cityName = locationData[0]?.name || "Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ";
                    
                    fetchWeatherData(lat, lon, cityName);
                    showAlert(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ: ${cityName}`, "success");
                    
                    if (domElements.locationBtn) {
                        domElements.locationBtn.classList.remove('loading');
                        domElements.locationBtn.classList.add('success');
                        setTimeout(() => {
                            domElements.locationBtn.classList.remove('success');
                        }, 2000);
                    }
                })
                .catch(() => {
                    fetchWeatherData(lat, lon, "Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ");
                    
                    if (domElements.locationBtn) {
                        domElements.locationBtn.classList.remove('loading');
                    }
                });
        },
        function(error) {
            console.error("Geolocation error:", error);
            showAlert("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error");
            
            if (domElements.locationBtn) {
                domElements.locationBtn.classList.remove('loading');
                domElements.locationBtn.classList.add('error');
                setTimeout(() => {
                    domElements.locationBtn.classList.remove('error');
                }, 2000);
            }
        },
        {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        }
    );
}

// ============================================
// 9. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
// ============================================

function getWeatherIconClass(iconCode) {
    const iconMap = {
        '01d': 'fa-sun',
        '01n': 'fa-moon',
        '02d': 'fa-cloud-sun',
        '02n': 'fa-cloud-moon',
        '03d': 'fa-cloud',
        '03n': 'fa-cloud',
        '04d': 'fa-cloud',
        '04n': 'fa-cloud',
        '09d': 'fa-cloud-rain',
        '09n': 'fa-cloud-rain',
        '10d': 'fa-cloud-sun-rain',
        '10n': 'fa-cloud-moon-rain',
        '11d': 'fa-bolt',
        '11n': 'fa-bolt',
        '13d': 'fa-snowflake',
        '13n': 'fa-snowflake',
        '50d': 'fa-smog',
        '50n': 'fa-smog'
    };
    
    return iconMap[iconCode] || 'fa-cloud';
}

function mode(arr) {
    return arr.sort((a, b) =>
        arr.filter(v => v === a).length - arr.filter(v => v === b).length
    ).pop();
}

function updateCurrentTime() {
    const now = new Date();
    const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    };
    
    // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª
}

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    
    if (document.body.classList.contains('dark-mode')) {
        localStorage.setItem('darkMode', 'enabled');
        domElements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
        localStorage.setItem('darkMode', 'disabled');
        domElements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }
}

function toggleMobileMenu() {
    domElements.mainNav.classList.toggle('active');
}

function showAlert(message, type = 'info') {
    domElements.alertText.textContent = message;
    domElements.alertBanner.style.display = 'flex';
    
    // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    switch (type) {
        case 'error':
            domElements.alertBanner.style.backgroundColor = 'var(--algeria-red)';
            break;
        case 'success':
            domElements.alertBanner.style.backgroundColor = 'var(--success-green)';
            break;
        case 'warning':
            domElements.alertBanner.style.backgroundColor = 'var(--warning-orange)';
            break;
        default:
            domElements.alertBanner.style.backgroundColor = 'var(--primary-blue)';
    }
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
    setTimeout(() => {
        domElements.alertBanner.style.display = 'none';
    }, 5000);
}

function updateApiStatus(status) {
    if (status === 'connected') {
        domElements.apiStatus.innerHTML = '<i class="fas fa-check-circle"></i> <span>API Connected</span>';
        domElements.apiStatus.classList.remove('error');
    } else {
        domElements.apiStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> <span>API Error</span>';
        domElements.apiStatus.classList.add('error');
    }
}

// ============================================
// 10. Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
// ============================================

function displaySampleData() {
    // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø·Ù‚Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ
    domElements.currentCity.textContent = "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©ØŒ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±";
    domElements.currentTemp.textContent = "25Â°";
    domElements.currentCondition.textContent = "Ù…Ø´Ù…Ø³";
    domElements.weatherIcon.innerHTML = '<i class="fas fa-sun"></i>';
    domElements.updateTime.textContent = new Date().toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    const detailsHTML = `
        <div class="detail-item">
            <i class="fas fa-thermometer-half"></i>
            <div>27Â°</div>
            <div>ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-tint"></i>
            <div>65%</div>
            <div>Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-wind"></i>
            <div>15 ÙƒÙ…/Ø³</div>
            <div>Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</div>
        </div>
        <div class="detail-item">
            <i class="fas fa-compress-arrows-alt"></i>
            <div>1013 Ù‡ÙƒØªÙˆØ¨Ø§Ø³ÙƒØ§Ù„</div>
            <div>Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ</div>
        </div>
    `;
    
    domElements.weatherDetails.innerHTML = detailsHTML;
}

function displaySampleForecast() {
    // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªÙ†Ø¨Ø¤Ø§Øª
    const days = ['Ø§Ù„ÙŠÙˆÙ…', 'ØºØ¯Ø§Ù‹', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'];
    
    const forecastHTML = days.map((day, index) => {
        const highTemp = 25 + Math.floor(Math.random() * 5);
        const lowTemp = highTemp - 5 - Math.floor(Math.random() * 3);
        const icons = ['fa-sun', 'fa-cloud-sun', 'fa-cloud', 'fa-cloud-rain'];
        const icon = icons[Math.floor(Math.random() * icons.length)];
        
        return `
            <div class="forecast-card">
                <div class="forecast-day">${day}</div>
                <div class="forecast-date">${index + 1} ÙŠÙˆÙ†ÙŠÙˆ</div>
                <div class="forecast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="condition">${icon === 'fa-sun' ? 'Ù…Ø´Ù…Ø³' : icon === 'fa-cloud-rain' ? 'Ù…Ù…Ø·Ø±' : 'ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠØ§Ù‹'}</div>
                <div class="forecast-temp">
                    <span class="high-temp">${highTemp}Â°</span>
                    <span class="low-temp">${lowTemp}Â°</span>
                </div>
            </div>
        `;
    }).join('');
    
    domElements.forecastContainer.innerHTML = forecastHTML;
}

// Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯
let newsUpdateInterval;

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
async function loadWeatherNews() {
    try {
        showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬ÙˆÙŠØ©...', 'info');
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©
        const newsPromises = [
            loadFromNewsAPI(),
            loadFromRSSFeeds(),
            loadFromOpenWeatherAlerts()
        ];
        
        const results = await Promise.allSettled(newsPromises);
        const allNews = [];
        
        results.forEach(result => {
            if (result.status === 'fulfilled' && result.value) {
                allNews.push(...result.value);
            }
        });
        
        if (allNews.length > 0) {
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
            allNews.sort((a, b) => new Date(b.publishedAt || b.time) - new Date(a.publishedAt || a.time));
            displayNewsArticles(allNews.slice(0, 4));
            showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬ÙˆÙŠØ©', 'success');
        } else {
            displayFallbackNews();
        }
        
    } catch (error) {
        console.error('Error loading news:', error);
        displayFallbackNews();
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
function startNewsAutoUpdate() {
    // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ
    loadWeatherNews();
    
    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
    newsUpdateInterval = setInterval(loadWeatherNews, 10 * 60 * 1000);
    
    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© (Ù„Ù„Ø­Ø±ÙƒØ©)
    setInterval(rotateTicker, 30 * 1000);
}

function rotateTicker() {
    const ticker = domElements.newsTicker;
    if (ticker.children.length > 1) {
        const firstItem = ticker.firstElementChild;
        ticker.removeChild(firstItem);
        ticker.appendChild(firstItem);
    }
}

const ALGERIAN_WEATHER_RSS = [
    {
        name: 'Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„Ø£Ø±ØµØ§Ø¯ Ø§Ù„Ø¬ÙˆÙŠØ©',
        url: 'https://www.meteo.dz/rss/actualites.xml',
        category: 'Ø±Ø³Ù…ÙŠ'
    }
];
// ============================================
// Ù†Ù‡Ø§ÙŠØ© ÙƒÙˆØ¯ JavaScript
// ============================================

    </script>

</body>

</html>
